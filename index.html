<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบการลางาน - กลุ่มงานโครงสร้างพื้นฐานและวิศวกรรมทางการแพทย์</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Sarabun', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-shadow { box-shadow: 0 15px 35px rgba(0,0,0,0.1); }
        .hover-scale { transition: all 0.3s ease; }
        .hover-scale:hover { transform: translateY(-5px); box-shadow: 0 20px 40px rgba(0,0,0,0.15); }
        .glass-effect { backdrop-filter: blur(10px); background: rgba(255,255,255,0.9); }
        .profile-img { width: 80px; height: 80px; object-fit: cover; }
        .status-badge { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        .department-card { border-left: 4px solid; transition: all 0.3s ease; }
        .department-card:hover { transform: translateX(5px); }
        .modal-backdrop { backdrop-filter: blur(5px); }
        .image-preview { max-width: 200px; max-height: 200px; object-fit: cover; }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Header -->
    <header class="gradient-bg text-white shadow-2xl sticky top-0 z-40">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="bg-white bg-opacity-20 p-3 rounded-full">
                        <i class="fas fa-hospital text-3xl"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold">ระบบการลางาน</h1>
                        <p class="text-blue-100 text-sm">กลุ่มงานโครงสร้างพื้นฐานและวิศวกรรมทางการแพทย์</p>
                    </div>
                </div>
                <div class="flex items-center space-x-6">
                    <div class="text-right">
                        <div id="currentTime" class="text-lg font-semibold"></div>
                        <div id="currentDate" class="text-blue-100 text-sm"></div>
                    </div>
                    <div class="flex items-center space-x-3">
                        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='40' height='40' viewBox='0 0 40 40'%3E%3Ccircle cx='20' cy='20' r='20' fill='%23ffffff'/%3E%3Ctext x='20' y='26' text-anchor='middle' fill='%23667eea' font-size='16' font-weight='bold'%3EAdmin%3C/text%3E%3C/svg%3E" class="w-10 h-10 rounded-full">
                        <div>
                            <p class="font-medium">ผู้ดูแลระบบ</p>
                            <p class="text-blue-100 text-xs">Online</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="glass-effect shadow-lg sticky top-20 z-30">
        <div class="container mx-auto px-6">
            <div class="flex space-x-1 overflow-x-auto">
                <button onclick="showSection('dashboard')" class="nav-btn py-4 px-6 rounded-t-lg bg-white text-blue-600 font-medium shadow-md whitespace-nowrap">
                    <i class="fas fa-tachometer-alt mr-2"></i>แดชบอร์ด
                </button>
                <button onclick="showSection('attendance')" class="nav-btn py-4 px-6 text-gray-600 hover:text-blue-600 hover:bg-white hover:shadow-md rounded-t-lg font-medium transition-all whitespace-nowrap">
                    <i class="fas fa-clock mr-2"></i>บันทึกเวลา
                </button>
                <button onclick="showSection('leave')" class="nav-btn py-4 px-6 text-gray-600 hover:text-blue-600 hover:bg-white hover:shadow-md rounded-t-lg font-medium transition-all whitespace-nowrap">
                    <i class="fas fa-calendar-alt mr-2"></i>ขอลางาน
                </button>
                <button onclick="showSection('employees')" class="nav-btn py-4 px-6 text-gray-600 hover:text-blue-600 hover:bg-white hover:shadow-md rounded-t-lg font-medium transition-all whitespace-nowrap">
                    <i class="fas fa-users mr-2"></i>จัดการพนักงาน
                </button>
                <button onclick="showSection('employee-list')" class="nav-btn py-4 px-6 text-gray-600 hover:text-blue-600 hover:bg-white hover:shadow-md rounded-t-lg font-medium transition-all whitespace-nowrap">
                    <i class="fas fa-list-ul mr-2"></i>รายชื่อพนักงาน
                </button>
                <button onclick="showSection('departments')" class="nav-btn py-4 px-6 text-gray-600 hover:text-blue-600 hover:bg-white hover:shadow-md rounded-t-lg font-medium transition-all whitespace-nowrap">
                    <i class="fas fa-building mr-2"></i>หมวดงาน
                </button>
                <button onclick="showSection('reports')" class="nav-btn py-4 px-6 text-gray-600 hover:text-blue-600 hover:bg-white hover:shadow-md rounded-t-lg font-medium transition-all whitespace-nowrap">
                    <i class="fas fa-chart-bar mr-2"></i>รายงาน
                </button>
            </div>
        </div>
    </nav>

    <div class="container mx-auto px-6 py-8">
        <!-- Dashboard Section -->
        <div id="dashboard" class="section">
            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="bg-white p-6 rounded-2xl card-shadow hover-scale">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm font-medium">มาทำงานวันนี้</p>
                            <p class="text-3xl font-bold text-green-600 mt-1">28</p>
                            <p class="text-green-500 text-xs mt-1">↑ 5% จากเมื่อวาน</p>
                        </div>
                        <div class="bg-green-100 p-4 rounded-full">
                            <i class="fas fa-user-check text-green-600 text-2xl"></i>
                        </div>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-2xl card-shadow hover-scale">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm font-medium">ลางานวันนี้</p>
                            <p class="text-3xl font-bold text-red-600 mt-1">4</p>
                            <p class="text-red-500 text-xs mt-1">2 ลาป่วย, 2 ลากิจ</p>
                        </div>
                        <div class="bg-red-100 p-4 rounded-full">
                            <i class="fas fa-user-times text-red-600 text-2xl"></i>
                        </div>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-2xl card-shadow hover-scale">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm font-medium">มาสาย</p>
                            <p class="text-3xl font-bold text-yellow-600 mt-1">3</p>
                            <p class="text-yellow-500 text-xs mt-1">↓ 2 คนจากเมื่อวาน</p>
                        </div>
                        <div class="bg-yellow-100 p-4 rounded-full">
                            <i class="fas fa-clock text-yellow-600 text-2xl"></i>
                        </div>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-2xl card-shadow hover-scale">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm font-medium">พนักงานทั้งหมด</p>
                            <p class="text-3xl font-bold text-blue-600 mt-1">32</p>
                            <p class="text-blue-500 text-xs mt-1">8 หมวดงาน</p>
                        </div>
                        <div class="bg-blue-100 p-4 rounded-full">
                            <i class="fas fa-users text-blue-600 text-2xl"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Department Overview -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                <div class="bg-white rounded-2xl card-shadow p-6">
                    <h3 class="text-xl font-bold mb-6 flex items-center">
                        <i class="fas fa-building text-blue-600 mr-3"></i>
                        สถานะหมวดงาน
                    </h3>
                    <div class="space-y-4">
                        <div class="department-card p-4 rounded-lg bg-gray-50 border-blue-500">
                            <div class="flex justify-between items-center">
                                <div class="flex items-center">
                                    <i class="fas fa-bolt text-blue-600 mr-3"></i>
                                    <span class="font-medium">หมวดไฟฟ้า</span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs">4/4 คน</span>
                                    <span class="status-badge w-3 h-3 bg-green-500 rounded-full"></span>
                                </div>
                            </div>
                        </div>
                        <div class="department-card p-4 rounded-lg bg-gray-50 border-orange-500">
                            <div class="flex justify-between items-center">
                                <div class="flex items-center">
                                    <i class="fas fa-fire text-orange-600 mr-3"></i>
                                    <span class="font-medium">หมวดเชื่อม</span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs">3/3 คน</span>
                                    <span class="status-badge w-3 h-3 bg-green-500 rounded-full"></span>
                                </div>
                            </div>
                        </div>
                        <div class="department-card p-4 rounded-lg bg-gray-50 border-gray-500">
                            <div class="flex justify-between items-center">
                                <div class="flex items-center">
                                    <i class="fas fa-hammer text-gray-600 mr-3"></i>
                                    <span class="font-medium">หมวดโยธาและประมาณราคา</span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span class="bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full text-xs">3/4 คน</span>
                                    <span class="status-badge w-3 h-3 bg-yellow-500 rounded-full"></span>
                                </div>
                            </div>
                        </div>
                        <div class="department-card p-4 rounded-lg bg-gray-50 border-cyan-500">
                            <div class="flex justify-between items-center">
                                <div class="flex items-center">
                                    <i class="fas fa-tint text-cyan-600 mr-3"></i>
                                    <span class="font-medium">หมวดประปา</span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs">3/3 คน</span>
                                    <span class="status-badge w-3 h-3 bg-green-500 rounded-full"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-2xl card-shadow p-6">
                    <h3 class="text-xl font-bold mb-6 flex items-center">
                        <i class="fas fa-clock text-green-600 mr-3"></i>
                        กิจกรรมล่าสุด
                    </h3>
                    <div class="space-y-4 max-h-80 overflow-y-auto">
                        <div class="flex items-center p-3 bg-green-50 rounded-lg border-l-4 border-green-500">
                            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='40' height='40' viewBox='0 0 40 40'%3E%3Ccircle cx='20' cy='20' r='20' fill='%2310b981'/%3E%3Ctext x='20' y='26' text-anchor='middle' fill='white' font-size='12'%3E%E0%B8%AA%E0%B8%A1%3C/text%3E%3C/svg%3E" class="w-10 h-10 rounded-full mr-3">
                            <div class="flex-1">
                                <p class="font-medium text-gray-800">นายสมชาย ใจดี</p>
                                <p class="text-sm text-gray-600">เข้างาน - หมวดไฟฟ้า</p>
                                <p class="text-xs text-green-600">08:00 น.</p>
                            </div>
                            <i class="fas fa-sign-in-alt text-green-600"></i>
                        </div>
                        <div class="flex items-center p-3 bg-blue-50 rounded-lg border-l-4 border-blue-500">
                            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='40' height='40' viewBox='0 0 40 40'%3E%3Ccircle cx='20' cy='20' r='20' fill='%233b82f6'/%3E%3Ctext x='20' y='26' text-anchor='middle' fill='white' font-size='12'%3E%E0%B8%A1%E0%B8%B2%3C/text%3E%3C/svg%3E" class="w-10 h-10 rounded-full mr-3">
                            <div class="flex-1">
                                <p class="font-medium text-gray-800">นางสาวมาลี รักงาน</p>
                                <p class="text-sm text-gray-600">ขอลาป่วย - หมวดธุรการ</p>
                                <p class="text-xs text-blue-600">07:30 น.</p>
                            </div>
                            <i class="fas fa-calendar text-blue-600"></i>
                        </div>
                        <div class="flex items-center p-3 bg-red-50 rounded-lg border-l-4 border-red-500">
                            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='40' height='40' viewBox='0 0 40 40'%3E%3Ccircle cx='20' cy='20' r='20' fill='%23ef4444'/%3E%3Ctext x='20' y='26' text-anchor='middle' fill='white' font-size='12'%3E%E0%B8%9B%E0%B8%A3%3C/text%3E%3C/svg%3E" class="w-10 h-10 rounded-full mr-3">
                            <div class="flex-1">
                                <p class="font-medium text-gray-800">นายประยุทธ์ ขยัน</p>
                                <p class="text-sm text-gray-600">ออกงาน - หมวดเชื่อม</p>
                                <p class="text-xs text-red-600">17:00 น.</p>
                            </div>
                            <i class="fas fa-sign-out-alt text-red-600"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Firebase Setup Guide -->
            <div class="bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-2xl p-6 mb-8">
                <h3 class="text-xl font-bold mb-4 flex items-center text-green-800">
                    <i class="fas fa-check-circle text-green-600 mr-3"></i>
                    Firebase พร้อมใช้งาน! 🎉
                </h3>
                <div class="bg-white rounded-xl p-4 mb-4">
                    <h4 class="font-semibold mb-3 text-green-800 flex items-center">
                        <i class="fas fa-rocket text-green-600 mr-2"></i>
                        ระบบพร้อมใช้งานแล้ว!
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="bg-green-50 p-3 rounded-lg border border-green-200">
                            <div class="flex items-center mb-2">
                                <i class="fas fa-database text-green-600 mr-2"></i>
                                <span class="font-medium text-green-800">Firestore</span>
                            </div>
                            <p class="text-sm text-green-700">เชื่อมต่อแล้ว</p>
                        </div>
                        <div class="bg-green-50 p-3 rounded-lg border border-green-200">
                            <div class="flex items-center mb-2">
                                <i class="fas fa-cloud-upload-alt text-green-600 mr-2"></i>
                                <span class="font-medium text-green-800">Storage</span>
                            </div>
                            <p class="text-sm text-green-700">พร้อมใช้งาน</p>
                        </div>
                        <div class="bg-green-50 p-3 rounded-lg border border-green-200">
                            <div class="flex items-center mb-2">
                                <i class="fas fa-shield-alt text-green-600 mr-2"></i>
                                <span class="font-medium text-green-800">Security</span>
                            </div>
                            <p class="text-sm text-green-700">ตั้งค่าแล้ว</p>
                        </div>
                    </div>
                </div>
                <div class="bg-blue-50 rounded-lg p-3 mb-4 border border-blue-200">
                    <h5 class="font-semibold text-blue-800 mb-2">
                        <i class="fas fa-info-circle text-blue-600 mr-2"></i>
                        การเชื่อมต่อ Firebase:
                    </h5>
                    <div class="bg-gray-800 text-green-400 p-3 rounded text-xs font-mono overflow-x-auto">
                        <div><span class="text-gray-500">// ✅ เชื่อมต่อสำเร็จ</span></div>
                        <div>const firebaseConfig = {</div>
                        <div>&nbsp;&nbsp;projectId: "<span class="text-green-300">leave-system-2df5a</span>",</div>
                        <div>&nbsp;&nbsp;authDomain: "<span class="text-green-300">leave-system-2df5a.firebaseapp.com</span>",</div>
                        <div>&nbsp;&nbsp;storageBucket: "<span class="text-green-300">leave-system-2df5a.firebasestorage.app</span>",</div>
                        <div>&nbsp;&nbsp;<span class="text-gray-500">// ... other config</span></div>
                        <div>};</div>
                    </div>
                </div>
                <div class="bg-blue-50 rounded-lg p-3 mb-4">
                    <h5 class="font-semibold text-blue-800 mb-2">Collections ที่จะสร้างอัตโนมัติ:</h5>
                    <ul class="text-sm text-blue-700 space-y-1">
                        <li>• <strong>employees</strong> - ข้อมูลพนักงาน (name, position, department, etc.)</li>
                        <li>• <strong>attendance</strong> - บันทึกเวลาเข้า-ออกงาน (employeeId, type, timestamp)</li>
                        <li>• <strong>leave_requests</strong> - คำขอลางาน (employeeId, leaveType, dates, status)</li>
                        <li>• <strong>leave_balances</strong> - วันลาคงเหลือ (remaining, lastUpdated, reason)</li>
                    </ul>
                </div>
                <div class="bg-red-50 rounded-lg p-3 mb-4 border border-red-200">
                    <h5 class="font-semibold text-red-800 mb-2">
                        <i class="fas fa-shield-alt text-red-600 mr-2"></i>
                        Security Rules สำคัญ:
                    </h5>
                    <p class="text-sm text-red-700 mb-2">ตั้งค่า Firestore Rules:</p>
                    <div class="bg-gray-800 text-green-400 p-2 rounded text-xs font-mono">
                        <div>rules_version = '2';</div>
                        <div>service cloud.firestore {</div>
                        <div>&nbsp;&nbsp;match /databases/{database}/documents {</div>
                        <div>&nbsp;&nbsp;&nbsp;&nbsp;match /{document=**} {</div>
                        <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;allow read, write: if true;</div>
                        <div>&nbsp;&nbsp;&nbsp;&nbsp;}</div>
                        <div>&nbsp;&nbsp;}</div>
                        <div>}</div>
                    </div>
                </div>
                <div class="text-sm text-green-700 bg-green-50 p-3 rounded-lg border border-green-200">
                    <i class="fas fa-check-circle mr-2"></i>
                    <strong>ระบบพร้อมใช้งานจริงแล้ว!</strong> สามารถเพิ่มพนักงาน บันทึกเวลา และขอลางานได้เลย! 🚀
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="bg-white rounded-2xl card-shadow p-6">
                <h3 class="text-xl font-bold mb-6 flex items-center">
                    <i class="fas fa-rocket text-purple-600 mr-3"></i>
                    การดำเนินการด่วน
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <button onclick="showSection('attendance')" class="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-6 rounded-xl hover:from-blue-600 hover:to-blue-700 transition-all transform hover:scale-105 shadow-lg">
                        <i class="fas fa-clock text-3xl mb-3"></i>
                        <p class="font-semibold">บันทึกเวลา</p>
                        <p class="text-blue-100 text-sm">เข้า-ออกงาน</p>
                    </button>
                    <button onclick="showSection('leave')" class="bg-gradient-to-r from-green-500 to-green-600 text-white p-6 rounded-xl hover:from-green-600 hover:to-green-700 transition-all transform hover:scale-105 shadow-lg">
                        <i class="fas fa-calendar-plus text-3xl mb-3"></i>
                        <p class="font-semibold">ขอลางาน</p>
                        <p class="text-green-100 text-sm">ส่งคำขอลา</p>
                    </button>
                    <button onclick="showSection('employees')" class="bg-gradient-to-r from-purple-500 to-purple-600 text-white p-6 rounded-xl hover:from-purple-600 hover:to-purple-700 transition-all transform hover:scale-105 shadow-lg">
                        <i class="fas fa-user-plus text-3xl mb-3"></i>
                        <p class="font-semibold">เพิ่มพนักงาน</p>
                        <p class="text-purple-100 text-sm">จัดการข้อมูล</p>
                    </button>
                    <button onclick="showSection('reports')" class="bg-gradient-to-r from-orange-500 to-orange-600 text-white p-6 rounded-xl hover:from-orange-600 hover:to-orange-700 transition-all transform hover:scale-105 shadow-lg">
                        <i class="fas fa-file-alt text-3xl mb-3"></i>
                        <p class="font-semibold">รายงาน</p>
                        <p class="text-orange-100 text-sm">ดูสถิติ</p>
                    </button>
                </div>
            </div>
        </div>

        <!-- Attendance Section -->
        <div id="attendance" class="section hidden">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Time Clock -->
                <div class="lg:col-span-2">
                    <div class="bg-white rounded-2xl card-shadow p-8">
                        <h2 class="text-2xl font-bold mb-6 flex items-center">
                            <i class="fas fa-clock text-blue-600 mr-3"></i>
                            บันทึกเวลาเข้า-ออกงาน
                        </h2>
                        
                        <div class="text-center mb-8">
                            <div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white p-8 rounded-2xl mb-6 shadow-lg">
                                <div id="digitalClock" class="text-5xl font-bold mb-2"></div>
                                <div id="digitalDate" class="text-lg opacity-90"></div>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <button onclick="clockIn()" class="bg-gradient-to-r from-green-500 to-green-600 text-white py-4 px-6 rounded-xl text-lg font-semibold hover:from-green-600 hover:to-green-700 transition-all transform hover:scale-105 shadow-lg">
                                    <i class="fas fa-sign-in-alt mr-2"></i>เข้างาน
                                </button>
                                <button onclick="clockOut()" class="bg-gradient-to-r from-red-500 to-red-600 text-white py-4 px-6 rounded-xl text-lg font-semibold hover:from-red-600 hover:to-red-700 transition-all transform hover:scale-105 shadow-lg">
                                    <i class="fas fa-sign-out-alt mr-2"></i>ออกงาน
                                </button>
                            </div>
                        </div>

                        <!-- Employee Selection -->
                        <div class="bg-gray-50 p-6 rounded-xl">
                            <label class="block text-sm font-semibold text-gray-700 mb-3">เลือกพนักงาน</label>
                            <select id="employeeSelect" class="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white shadow-sm">
                                <option value="">-- เลือกพนักงาน --</option>
                                <option value="emp1">นายสมชาย ใจดี - หัวหน้างานไฟฟ้า (พนักงานราชการ)</option>
                                <option value="emp2">นางสาวมาลี รักงาน - เจ้าหน้าที่ธุรการ (ราชการ)</option>
                                <option value="emp3">นายประยุทธ์ ขยัน - ช่างเชื่อม (พนักงานกระทรวงสาธารณะสุข)</option>
                                <option value="emp4">นายสมศักดิ์ มั่นคง - หัวหน้างานโยธา (ลูกจ้าง)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Today's Records -->
                <div class="bg-white rounded-2xl card-shadow p-6">
                    <h3 class="text-xl font-bold mb-6 flex items-center">
                        <i class="fas fa-list text-green-600 mr-3"></i>
                        บันทึกวันนี้
                    </h3>
                    <div id="todayRecords" class="space-y-3 max-h-96 overflow-y-auto">
                        <div class="flex items-center justify-between p-3 bg-green-50 rounded-lg border-l-4 border-green-500">
                            <div class="flex items-center">
                                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 32 32'%3E%3Ccircle cx='16' cy='16' r='16' fill='%2310b981'/%3E%3Ctext x='16' y='21' text-anchor='middle' fill='white' font-size='10'%3E%E0%B8%AA%E0%B8%A1%3C/text%3E%3C/svg%3E" class="w-8 h-8 rounded-full mr-3">
                                <div>
                                    <p class="font-medium text-sm">นายสมชาย ใจดี</p>
                                    <p class="text-xs text-gray-600">หมวดไฟฟ้า</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="text-sm font-semibold text-green-600">เข้า: 08:00</p>
                                <p class="text-xs text-gray-500">ตรงเวลา</p>
                            </div>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-green-50 rounded-lg border-l-4 border-green-500">
                            <div class="flex items-center">
                                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 32 32'%3E%3Ccircle cx='16' cy='16' r='16' fill='%23f59e0b'/%3E%3Ctext x='16' y='21' text-anchor='middle' fill='white' font-size='10'%3E%E0%B8%9B%E0%B8%A3%3C/text%3E%3C/svg%3E" class="w-8 h-8 rounded-full mr-3">
                                <div>
                                    <p class="font-medium text-sm">นายประยุทธ์ ขยัน</p>
                                    <p class="text-xs text-gray-600">หมวดเชื่อม</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="text-sm font-semibold text-yellow-600">เข้า: 08:15</p>
                                <p class="text-xs text-yellow-500">สาย 15 นาที</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Leave Request Section -->
        <div id="leave" class="section hidden">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Leave Balance Card -->
                <div class="bg-white rounded-2xl card-shadow p-6">
                    <h3 class="text-xl font-bold mb-6 flex items-center">
                        <i class="fas fa-calendar-check text-blue-600 mr-3"></i>
                        วันลาคงเหลือ
                    </h3>
                    
                    <div class="space-y-4">
                        <div class="bg-blue-50 p-4 rounded-xl border-l-4 border-blue-500">
                            <div class="flex justify-between items-center mb-2">
                                <span class="font-semibold text-blue-800">ลาพักร้อน</span>
                                <button onclick="showLeaveBalanceModal()" class="text-blue-600 hover:text-blue-800">
                                    <i class="fas fa-edit text-sm"></i>
                                </button>
                            </div>
                            <div class="text-2xl font-bold text-blue-600" id="vacationBalance">10</div>
                            <div class="text-sm text-blue-600">วัน (จากทั้งหมด 10 วัน)</div>
                        </div>
                        
                        <div class="bg-green-50 p-4 rounded-xl border-l-4 border-green-500">
                            <div class="flex justify-between items-center mb-2">
                                <span class="font-semibold text-green-800">ลาป่วย</span>
                                <span class="text-green-600 text-sm">ไม่จำกัด</span>
                            </div>
                            <div class="text-2xl font-bold text-green-600">∞</div>
                            <div class="text-sm text-green-600">วัน (ตามใบรับรองแพทย์)</div>
                        </div>
                        
                        <div class="bg-yellow-50 p-4 rounded-xl border-l-4 border-yellow-500">
                            <div class="flex justify-between items-center mb-2">
                                <span class="font-semibold text-yellow-800">ลากิจ</span>
                                <span class="text-yellow-600 text-sm">ไม่จำกัด</span>
                            </div>
                            <div class="text-2xl font-bold text-yellow-600">∞</div>
                            <div class="text-sm text-yellow-600">วัน (ไม่ได้รับเงินเดือน)</div>
                        </div>
                        
                        <div class="bg-purple-50 p-4 rounded-xl border-l-4 border-purple-500">
                            <div class="flex justify-between items-center mb-2">
                                <span class="font-semibold text-purple-800">ลาคลอด</span>
                                <span class="text-purple-600 text-sm">90 วัน</span>
                            </div>
                            <div class="text-2xl font-bold text-purple-600">90</div>
                            <div class="text-sm text-purple-600">วัน (สำหรับพนักงานหญิง)</div>
                        </div>
                    </div>
                    
                    <div class="mt-6 p-4 bg-gray-50 rounded-xl">
                        <h4 class="font-semibold mb-3 text-gray-800">สิทธิ์ตามประเภทการจ้าง</h4>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span class="text-gray-600">พนักงานราชการ:</span>
                                <span class="font-medium">10 วัน</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">ราชการ:</span>
                                <span class="font-medium">10 วัน</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">พนักงานกระทรวงฯ:</span>
                                <span class="font-medium">6 วัน</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">ลูกจ้าง:</span>
                                <span class="font-medium">6 วัน</span>
                            </div>
                        </div>
                        
                        <div class="mt-4 pt-4 border-t border-gray-200">
                            <h5 class="font-semibold mb-2 text-gray-800 flex items-center">
                                <i class="fas fa-clock text-blue-600 mr-2"></i>
                                เวลาปฏิบัติงาน
                            </h5>
                            <div class="space-y-1 text-sm text-gray-600">
                                <p><strong>วันจันทร์ - ศุกร์:</strong> 8:30 - 16:30 น.</p>
                                <p><strong>พักเที่ยง:</strong> 12:00 - 13:00 น.</p>
                                <p><strong>วันหยุด:</strong> เสาร์-อาทิตย์ และวันหยุดราชการ</p>
                            </div>
                        </div>
                        
                        <div class="mt-3 p-3 bg-blue-50 rounded-lg border border-blue-200">
                            <p class="text-xs text-blue-800">
                                <i class="fas fa-info-circle mr-1"></i>
                                การคำนวณวันลาใช้เฉพาะวันทำงาน ไม่รวมวันหยุดสุดสัปดาห์และวันหยุดราชการ
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Leave Form -->
                <div class="bg-white rounded-2xl card-shadow p-8">
                    <h2 class="text-2xl font-bold mb-6 flex items-center">
                        <i class="fas fa-calendar-alt text-green-600 mr-3"></i>
                        ขอลางาน
                    </h2>
                    
                    <form id="leaveForm" class="space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">พนักงาน</label>
                                <select id="leaveEmployeeSelect" onchange="updateLeaveBalance()" class="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 bg-white shadow-sm">
                                    <option value="">-- เลือกพนักงาน --</option>
                                    <option value="emp1" data-type="พนักงานราชการ" data-vacation="10">นายสมชาย ใจดี - หมวดไฟฟ้า (พนักงานราชการ)</option>
                                    <option value="emp2" data-type="ราชการ" data-vacation="10">นางสาวมาลี รักงาน - หมวดธุรการ (ราชการ)</option>
                                    <option value="emp3" data-type="พนักงานกระทรวงสาธารณะสุข" data-vacation="6">นายประยุทธ์ ขยัน - หมวดเชื่อม (พนักงานกระทรวงฯ)</option>
                                    <option value="emp4" data-type="ลูกจ้าง" data-vacation="6">นายสมศักดิ์ มั่นคง - หมวดโยธา (ลูกจ้าง)</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">ประเภทการลา</label>
                                <select id="leaveTypeSelect" onchange="checkLeaveEligibility()" class="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 bg-white shadow-sm">
                                    <option value="">-- เลือกประเภทการลา --</option>
                                    <option value="sick">ลาป่วย</option>
                                    <option value="personal">ลากิจ</option>
                                    <option value="vacation">ลาพักร้อน</option>
                                    <option value="maternity">ลาคลอด</option>
                                    <option value="ordination">ลาบวช</option>
                                    <option value="study">ลาศึกษา</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Leave Balance Warning -->
                        <div id="leaveWarning" class="hidden bg-yellow-50 border border-yellow-200 rounded-xl p-4">
                            <div class="flex items-center">
                                <i class="fas fa-exclamation-triangle text-yellow-600 mr-3"></i>
                                <div>
                                    <p class="font-semibold text-yellow-800">แจ้งเตือนวันลาพักร้อน</p>
                                    <p class="text-yellow-700 text-sm" id="leaveWarningText"></p>
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">วันที่เริ่มลา</label>
                                <input type="date" id="startDate" onchange="calculateLeaveDays()" class="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 shadow-sm">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">วันที่สิ้นสุด</label>
                                <input type="date" id="endDate" onchange="calculateLeaveDays()" class="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 shadow-sm">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">จำนวนวัน</label>
                                <div class="w-full p-4 border border-gray-300 rounded-xl bg-gray-50 flex items-center justify-center">
                                    <span id="leaveDaysCount" class="text-2xl font-bold text-blue-600">0</span>
                                    <span class="text-gray-600 ml-2">วัน</span>
                                </div>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">เหตุผลการลา</label>
                            <textarea rows="4" class="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 shadow-sm" placeholder="กรุณาระบุเหตุผลการลาอย่างละเอียด..."></textarea>
                        </div>

                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">แนบเอกสาร (ถ้ามี)</label>
                            <div class="border-2 border-dashed border-gray-300 rounded-xl p-6 text-center hover:border-blue-500 transition-colors">
                                <i class="fas fa-cloud-upload-alt text-3xl text-gray-400 mb-2"></i>
                                <p class="text-gray-600">ลากไฟล์มาวางที่นี่ หรือ <span class="text-blue-600 cursor-pointer">เลือกไฟล์</span></p>
                                <input type="file" class="hidden" accept=".pdf,.jpg,.jpeg,.png">
                            </div>
                        </div>

                        <div class="flex space-x-4">
                            <button type="submit" class="flex-1 bg-gradient-to-r from-blue-500 to-blue-600 text-white py-4 px-6 rounded-xl font-semibold hover:from-blue-600 hover:to-blue-700 transition-all transform hover:scale-105 shadow-lg">
                                <i class="fas fa-paper-plane mr-2"></i>ส่งคำขอ
                            </button>
                            <button type="reset" class="flex-1 bg-gray-500 text-white py-4 px-6 rounded-xl font-semibold hover:bg-gray-600 transition-all shadow-lg">
                                <i class="fas fa-undo mr-2"></i>ล้างข้อมูล
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Leave Requests List -->
                <div class="bg-white rounded-2xl card-shadow p-8">
                    <h3 class="text-xl font-bold mb-6 flex items-center">
                        <i class="fas fa-list-alt text-purple-600 mr-3"></i>
                        คำขอลางานล่าสุด
                    </h3>
                    <div class="space-y-4 max-h-96 overflow-y-auto">
                        <div class="border border-gray-200 rounded-xl p-4 hover:shadow-md transition-shadow">
                            <div class="flex items-center justify-between mb-3">
                                <div class="flex items-center">
                                    <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='40' height='40' viewBox='0 0 40 40'%3E%3Ccircle cx='20' cy='20' r='20' fill='%233b82f6'/%3E%3Ctext x='20' y='26' text-anchor='middle' fill='white' font-size='12'%3E%E0%B8%A1%E0%B8%B2%3C/text%3E%3C/svg%3E" class="w-10 h-10 rounded-full mr-3">
                                    <div>
                                        <p class="font-semibold">นางสาวมาลี รักงาน</p>
                                        <p class="text-sm text-gray-600">หมวดธุรการ</p>
                                    </div>
                                </div>
                                <span class="bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full text-sm font-medium">รอพิจารณา</span>
                            </div>
                            <div class="grid grid-cols-2 gap-4 text-sm">
                                <div>
                                    <p class="text-gray-600">ประเภท: <span class="font-medium">ลาป่วย</span></p>
                                    <p class="text-gray-600">วันที่: <span class="font-medium">15-20 ม.ค. 2567</span></p>
                                </div>
                                <div class="text-right">
                                    <button class="bg-green-500 text-white px-3 py-1 rounded-lg text-xs hover:bg-green-600 transition mr-2">อนุมัติ</button>
                                    <button class="bg-red-500 text-white px-3 py-1 rounded-lg text-xs hover:bg-red-600 transition">ปฏิเสธ</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="border border-gray-200 rounded-xl p-4 hover:shadow-md transition-shadow">
                            <div class="flex items-center justify-between mb-3">
                                <div class="flex items-center">
                                    <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='40' height='40' viewBox='0 0 40 40'%3E%3Ccircle cx='20' cy='20' r='20' fill='%2310b981'/%3E%3Ctext x='20' y='26' text-anchor='middle' fill='white' font-size='12'%3E%E0%B8%AA%E0%B8%A1%3C/text%3E%3C/svg%3E" class="w-10 h-10 rounded-full mr-3">
                                    <div>
                                        <p class="font-semibold">นายสมชาย ใจดี</p>
                                        <p class="text-sm text-gray-600">หมวดไฟฟ้า</p>
                                    </div>
                                </div>
                                <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium">อนุมัติ</span>
                            </div>
                            <div class="grid grid-cols-2 gap-4 text-sm">
                                <div>
                                    <p class="text-gray-600">ประเภท: <span class="font-medium">ลากิจ</span></p>
                                    <p class="text-gray-600">วันที่: <span class="font-medium">10 ม.ค. 2567</span></p>
                                </div>
                                <div class="text-right">
                                    <button class="bg-blue-500 text-white px-3 py-1 rounded-lg text-xs hover:bg-blue-600 transition">ดูรายละเอียด</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Employee List Section -->
        <div id="employee-list" class="section hidden">
            <div class="bg-white rounded-2xl card-shadow p-8">
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-2xl font-bold flex items-center">
                        <i class="fas fa-list-ul text-blue-600 mr-3"></i>
                        รายชื่อพนักงานทั้งหมด
                    </h2>
                    <div class="flex space-x-3">
                        <button onclick="loadEmployeeList()" class="bg-gradient-to-r from-green-500 to-green-600 text-white px-6 py-3 rounded-xl font-semibold hover:from-green-600 hover:to-green-700 transition-all transform hover:scale-105 shadow-lg">
                            <i class="fas fa-sync-alt mr-2"></i>รีเฟรช
                        </button>
                        <button onclick="exportEmployeeList()" class="bg-gradient-to-r from-purple-500 to-purple-600 text-white px-6 py-3 rounded-xl font-semibold hover:from-purple-600 hover:to-purple-700 transition-all transform hover:scale-105 shadow-lg">
                            <i class="fas fa-download mr-2"></i>ส่งออก Excel
                        </button>
                    </div>
                </div>

                <!-- Search and Filter -->
                <div class="bg-gray-50 p-6 rounded-xl mb-8">
                    <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
                        <div class="relative">
                            <input type="text" id="searchEmployee" placeholder="ค้นหาชื่อ, รหัส, ตำแหน่ง, หมวดงาน..." class="w-full p-3 pl-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white shadow-sm" onkeyup="filterEmployeeList()" oninput="filterEmployeeList()">
                            <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                        </div>
                        <select id="filterDepartment" class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white shadow-sm" onchange="filterEmployeeList()">
                            <option value="">ทุกหมวดงาน</option>
                            <option value="หมวดไฟฟ้า">หมวดไฟฟ้า</option>
                            <option value="หมวดเชื่อม">หมวดเชื่อม</option>
                            <option value="หมวดโยธาและประมาณราคา">หมวดโยธาและประมาณราคา</option>
                            <option value="หมวดประปา">หมวดประปา</option>
                            <option value="หมวดไม้">หมวดไม้</option>
                            <option value="หมวดเครื่องปรับอากาศ">หมวดเครื่องปรับอากาศ</option>
                            <option value="หมวดธุรการ">หมวดธุรการ</option>
                            <option value="หมวดเครื่องมือแพทย์">หมวดเครื่องมือแพทย์</option>
                        </select>
                        <select id="filterEmployeeType" class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white shadow-sm" onchange="filterEmployeeList()">
                            <option value="">ทุกประเภท</option>
                            <option value="พนักงานราชการ">พนักงานราชการ</option>
                            <option value="ราชการ">ราชการ</option>
                            <option value="พนักงานกระทรวงสาธารณะสุข">พนักงานกระทรวงสาธารณะสุข</option>
                            <option value="ลูกจ้าง">ลูกจ้าง</option>
                        </select>
                        <select id="filterStatus" class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white shadow-sm" onchange="filterEmployeeList()">
                            <option value="">ทุกสถานะ</option>
                            <option value="active">ปฏิบัติงาน</option>
                            <option value="inactive">ไม่ปฏิบัติงาน</option>
                        </select>
                        <div class="flex space-x-2">
                            <button onclick="clearFilters()" class="flex-1 bg-gray-500 text-white px-4 py-3 rounded-lg hover:bg-gray-600 transition font-medium">
                                <i class="fas fa-times mr-2"></i>ล้าง
                            </button>
                            <button onclick="filterEmployeeList()" class="flex-1 bg-blue-500 text-white px-4 py-3 rounded-lg hover:bg-blue-600 transition font-medium">
                                <i class="fas fa-search mr-2"></i>ค้นหา
                            </button>
                        </div>
                    </div>
                    
                    <!-- Filter Results Summary -->
                    <div id="filterSummary" class="mt-4 text-sm text-gray-600 hidden">
                        <i class="fas fa-filter mr-2"></i>
                        <span id="filterSummaryText"></span>
                    </div>
                </div>

                <!-- Employee Count Summary -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                    <div class="bg-blue-50 p-4 rounded-xl border-l-4 border-blue-500">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-blue-800 font-semibold">พนักงานทั้งหมด</p>
                                <p class="text-2xl font-bold text-blue-600" id="totalEmployees">0</p>
                            </div>
                            <i class="fas fa-users text-blue-500 text-2xl"></i>
                        </div>
                    </div>
                    <div class="bg-green-50 p-4 rounded-xl border-l-4 border-green-500">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-green-800 font-semibold">ปฏิบัติงาน</p>
                                <p class="text-2xl font-bold text-green-600" id="activeEmployees">0</p>
                            </div>
                            <i class="fas fa-user-check text-green-500 text-2xl"></i>
                        </div>
                    </div>
                    <div class="bg-yellow-50 p-4 rounded-xl border-l-4 border-yellow-500">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-yellow-800 font-semibold">พนักงานราชการ</p>
                                <p class="text-2xl font-bold text-yellow-600" id="governmentEmployees">0</p>
                            </div>
                            <i class="fas fa-building text-yellow-500 text-2xl"></i>
                        </div>
                    </div>
                    <div class="bg-purple-50 p-4 rounded-xl border-l-4 border-purple-500">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-purple-800 font-semibold">ลูกจ้าง</p>
                                <p class="text-2xl font-bold text-purple-600" id="contractEmployees">0</p>
                            </div>
                            <i class="fas fa-handshake text-purple-500 text-2xl"></i>
                        </div>
                    </div>
                </div>

                <!-- Employee Table -->
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse bg-white rounded-xl overflow-hidden shadow-sm">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="p-4 text-left font-semibold text-gray-700 border-b">รูปภาพ</th>
                                <th class="p-4 text-left font-semibold text-gray-700 border-b">รหัส</th>
                                <th class="p-4 text-left font-semibold text-gray-700 border-b">ชื่อ-นามสกุล</th>
                                <th class="p-4 text-left font-semibold text-gray-700 border-b">ตำแหน่ง</th>
                                <th class="p-4 text-left font-semibold text-gray-700 border-b">หมวดงาน</th>
                                <th class="p-4 text-left font-semibold text-gray-700 border-b">ประเภท</th>
                                <th class="p-4 text-left font-semibold text-gray-700 border-b">เบอร์โทร</th>
                                <th class="p-4 text-left font-semibold text-gray-700 border-b">สถานะ</th>
                                <th class="p-4 text-left font-semibold text-gray-700 border-b">จัดการ</th>
                            </tr>
                        </thead>
                        <tbody id="employeeTableBody">
                            <tr>
                                <td colspan="9" class="p-8 text-center text-gray-500">
                                    <i class="fas fa-spinner fa-spin text-2xl mb-2"></i>
                                    <p>กำลังโหลดข้อมูล...</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Pagination -->
                <div class="flex justify-between items-center mt-6">
                    <div class="text-sm text-gray-600">
                        แสดง <span id="showingFrom">0</span>-<span id="showingTo">0</span> จาก <span id="totalRecords">0</span> รายการ
                    </div>
                    <div class="flex space-x-2" id="paginationControls">
                        <!-- Pagination buttons will be generated here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Employee Management Section -->
        <div id="employees" class="section hidden">
            <div class="bg-white rounded-2xl card-shadow p-8">
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-2xl font-bold flex items-center">
                        <i class="fas fa-users text-blue-600 mr-3"></i>
                        จัดการข้อมูลพนักงาน
                    </h2>
                    <div class="flex space-x-3">
                        <button onclick="loadEmployees()" class="bg-gradient-to-r from-green-500 to-green-600 text-white px-6 py-3 rounded-xl font-semibold hover:from-green-600 hover:to-green-700 transition-all transform hover:scale-105 shadow-lg">
                            <i class="fas fa-sync-alt mr-2"></i>รีเฟรช
                        </button>
                        <button onclick="showAddEmployeeModal()" class="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-6 py-3 rounded-xl font-semibold hover:from-blue-600 hover:to-blue-700 transition-all transform hover:scale-105 shadow-lg">
                            <i class="fas fa-plus mr-2"></i>เพิ่มพนักงาน
                        </button>
                    </div>
                </div>

                <!-- Search and Filter -->
                <div class="bg-gray-50 p-6 rounded-xl mb-8">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <input type="text" placeholder="ค้นหาชื่อพนักงาน..." class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white shadow-sm">
                        <select class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white shadow-sm">
                            <option>ทุกหมวดงาน</option>
                            <option>หมวดไฟฟ้า</option>
                            <option>หมวดเชื่อม</option>
                            <option>หมวดโยธาและประมาณราคา</option>
                            <option>หมวดประปา</option>
                            <option>หมวดไม้</option>
                            <option>หมวดเครื่องปรับอากาศ</option>
                            <option>หมวดธุรการ</option>
                            <option>หมวดเครื่องมือแพทย์</option>
                        </select>
                        <select class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white shadow-sm">
                            <option>ทุกประเภท</option>
                            <option>พนักงานราชการ</option>
                            <option>ราชการ</option>
                            <option>พนักงานกระทรวงสาธารณะสุข</option>
                            <option>ลูกจ้าง</option>
                        </select>
                        <button class="bg-blue-500 text-white px-4 py-3 rounded-lg hover:bg-blue-600 transition font-medium">
                            <i class="fas fa-search mr-2"></i>ค้นหา
                        </button>
                    </div>
                </div>

                <!-- Employee Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="bg-white border border-gray-200 rounded-xl p-6 hover-scale">
                        <div class="flex items-center mb-4">
                            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='80' height='80' viewBox='0 0 80 80'%3E%3Ccircle cx='40' cy='40' r='40' fill='%2310b981'/%3E%3Ctext x='40' y='50' text-anchor='middle' fill='white' font-size='24'%3E%E0%B8%AA%E0%B8%A1%3C/text%3E%3C/svg%3E" class="profile-img rounded-full mr-4">
                            <div class="flex-1">
                                <h3 class="font-bold text-lg">นายสมชาย ใจดี</h3>
                                <p class="text-gray-600">หัวหน้างานไฟฟ้า</p>
                                <p class="text-sm text-blue-600">หมวดไฟฟ้า</p>
                            </div>
                        </div>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span class="text-gray-600">รหัส:</span>
                                <span class="font-medium">EMP001</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">ประเภท:</span>
                                <span class="font-medium">พนักงานราชการ</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">สถานะ:</span>
                                <span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs">ปฏิบัติงาน</span>
                            </div>
                        </div>
                        <div class="flex space-x-2 mt-4">
                            <button class="flex-1 bg-blue-500 text-white py-2 px-3 rounded-lg text-sm hover:bg-blue-600 transition">
                                <i class="fas fa-edit mr-1"></i>แก้ไข
                            </button>
                            <button class="flex-1 bg-red-500 text-white py-2 px-3 rounded-lg text-sm hover:bg-red-600 transition">
                                <i class="fas fa-trash mr-1"></i>ลบ
                            </button>
                        </div>
                    </div>

                    <div class="bg-white border border-gray-200 rounded-xl p-6 hover-scale">
                        <div class="flex items-center mb-4">
                            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='80' height='80' viewBox='0 0 80 80'%3E%3Ccircle cx='40' cy='40' r='40' fill='%233b82f6'/%3E%3Ctext x='40' y='50' text-anchor='middle' fill='white' font-size='24'%3E%E0%B8%A1%E0%B8%B2%3C/text%3E%3C/svg%3E" class="profile-img rounded-full mr-4">
                            <div class="flex-1">
                                <h3 class="font-bold text-lg">นางสาวมาลี รักงาน</h3>
                                <p class="text-gray-600">เจ้าหน้าที่ธุรการ</p>
                                <p class="text-sm text-blue-600">หมวดธุรการ</p>
                            </div>
                        </div>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span class="text-gray-600">รหัส:</span>
                                <span class="font-medium">EMP002</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">ประเภท:</span>
                                <span class="font-medium">ราชการ</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">สถานะ:</span>
                                <span class="bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full text-xs">ลาป่วย</span>
                            </div>
                        </div>
                        <div class="flex space-x-2 mt-4">
                            <button class="flex-1 bg-blue-500 text-white py-2 px-3 rounded-lg text-sm hover:bg-blue-600 transition">
                                <i class="fas fa-edit mr-1"></i>แก้ไข
                            </button>
                            <button class="flex-1 bg-red-500 text-white py-2 px-3 rounded-lg text-sm hover:bg-red-600 transition">
                                <i class="fas fa-trash mr-1"></i>ลบ
                            </button>
                        </div>
                    </div>

                    <div class="bg-white border border-gray-200 rounded-xl p-6 hover-scale">
                        <div class="flex items-center mb-4">
                            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='80' height='80' viewBox='0 0 80 80'%3E%3Ccircle cx='40' cy='40' r='40' fill='%23f59e0b'/%3E%3Ctext x='40' y='50' text-anchor='middle' fill='white' font-size='24'%3E%E0%B8%9B%E0%B8%A3%3C/text%3E%3C/svg%3E" class="profile-img rounded-full mr-4">
                            <div class="flex-1">
                                <h3 class="font-bold text-lg">นายประยุทธ์ ขยัน</h3>
                                <p class="text-gray-600">ช่างเชื่อม</p>
                                <p class="text-sm text-blue-600">หมวดเชื่อม</p>
                            </div>
                        </div>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span class="text-gray-600">รหัส:</span>
                                <span class="font-medium">EMP003</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">ประเภท:</span>
                                <span class="font-medium">พนักงานกระทรวงสาธารณะสุข</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">สถานะ:</span>
                                <span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs">ปฏิบัติงาน</span>
                            </div>
                        </div>
                        <div class="flex space-x-2 mt-4">
                            <button class="flex-1 bg-blue-500 text-white py-2 px-3 rounded-lg text-sm hover:bg-blue-600 transition">
                                <i class="fas fa-edit mr-1"></i>แก้ไข
                            </button>
                            <button class="flex-1 bg-red-500 text-white py-2 px-3 rounded-lg text-sm hover:bg-red-600 transition">
                                <i class="fas fa-trash mr-1"></i>ลบ
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Departments Section -->
        <div id="departments" class="section hidden">
            <div class="bg-white rounded-2xl card-shadow p-8">
                <h2 class="text-2xl font-bold mb-8 flex items-center">
                    <i class="fas fa-building text-blue-600 mr-3"></i>
                    จัดการหมวดงาน
                </h2>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="department-card bg-blue-50 p-6 rounded-xl border-blue-500 hover-scale">
                        <div class="text-center">
                            <div class="bg-blue-500 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-bolt text-white text-2xl"></i>
                            </div>
                            <h3 class="font-bold text-lg mb-2">หมวดไฟฟ้า</h3>
                            <p class="text-gray-600 text-sm mb-4">งานระบบไฟฟ้าและแสงสว่าง</p>
                            <div class="space-y-2">
                                <div class="flex justify-between text-sm">
                                    <span>พนักงาน:</span>
                                    <span class="font-semibold">4 คน</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span>มาทำงาน:</span>
                                    <span class="text-green-600 font-semibold">4 คน</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="department-card bg-orange-50 p-6 rounded-xl border-orange-500 hover-scale">
                        <div class="text-center">
                            <div class="bg-orange-500 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-fire text-white text-2xl"></i>
                            </div>
                            <h3 class="font-bold text-lg mb-2">หมวดเชื่อม</h3>
                            <p class="text-gray-600 text-sm mb-4">งานเชื่อมและโลหะ</p>
                            <div class="space-y-2">
                                <div class="flex justify-between text-sm">
                                    <span>พนักงาน:</span>
                                    <span class="font-semibold">3 คน</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span>มาทำงาน:</span>
                                    <span class="text-green-600 font-semibold">3 คน</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="department-card bg-gray-50 p-6 rounded-xl border-gray-500 hover-scale">
                        <div class="text-center">
                            <div class="bg-gray-500 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-hammer text-white text-2xl"></i>
                            </div>
                            <h3 class="font-bold text-lg mb-2">หมวดโยธาและประมาณราคา</h3>
                            <p class="text-gray-600 text-sm mb-4">งานก่อสร้างและประมาณราคา</p>
                            <div class="space-y-2">
                                <div class="flex justify-between text-sm">
                                    <span>พนักงาน:</span>
                                    <span class="font-semibold">4 คน</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span>มาทำงาน:</span>
                                    <span class="text-yellow-600 font-semibold">3 คน</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="department-card bg-cyan-50 p-6 rounded-xl border-cyan-500 hover-scale">
                        <div class="text-center">
                            <div class="bg-cyan-500 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-tint text-white text-2xl"></i>
                            </div>
                            <h3 class="font-bold text-lg mb-2">หมวดประปา</h3>
                            <p class="text-gray-600 text-sm mb-4">งานระบบประปาและสุขาภิบาล</p>
                            <div class="space-y-2">
                                <div class="flex justify-between text-sm">
                                    <span>พนักงาน:</span>
                                    <span class="font-semibold">3 คน</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span>มาทำงาน:</span>
                                    <span class="text-green-600 font-semibold">3 คน</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="department-card bg-amber-50 p-6 rounded-xl border-amber-500 hover-scale">
                        <div class="text-center">
                            <div class="bg-amber-500 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-tree text-white text-2xl"></i>
                            </div>
                            <h3 class="font-bold text-lg mb-2">หมวดไม้</h3>
                            <p class="text-gray-600 text-sm mb-4">งานไม้และตกแต่ง</p>
                            <div class="space-y-2">
                                <div class="flex justify-between text-sm">
                                    <span>พนักงาน:</span>
                                    <span class="font-semibold">2 คน</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span>มาทำงาน:</span>
                                    <span class="text-green-600 font-semibold">2 คน</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="department-card bg-indigo-50 p-6 rounded-xl border-indigo-500 hover-scale">
                        <div class="text-center">
                            <div class="bg-indigo-500 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-snowflake text-white text-2xl"></i>
                            </div>
                            <h3 class="font-bold text-lg mb-2">หมวดเครื่องปรับอากาศ</h3>
                            <p class="text-gray-600 text-sm mb-4">งานระบบปรับอากาศ</p>
                            <div class="space-y-2">
                                <div class="flex justify-between text-sm">
                                    <span>พนักงาน:</span>
                                    <span class="font-semibold">3 คน</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span>มาทำงาน:</span>
                                    <span class="text-green-600 font-semibold">3 คน</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="department-card bg-purple-50 p-6 rounded-xl border-purple-500 hover-scale">
                        <div class="text-center">
                            <div class="bg-purple-500 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-file-alt text-white text-2xl"></i>
                            </div>
                            <h3 class="font-bold text-lg mb-2">หมวดธุรการ</h3>
                            <p class="text-gray-600 text-sm mb-4">งานธุรการและเอกสาร</p>
                            <div class="space-y-2">
                                <div class="flex justify-between text-sm">
                                    <span>พนักงาน:</span>
                                    <span class="font-semibold">4 คน</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span>มาทำงาน:</span>
                                    <span class="text-yellow-600 font-semibold">3 คน</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="department-card bg-emerald-50 p-6 rounded-xl border-emerald-500 hover-scale">
                        <div class="text-center">
                            <div class="bg-emerald-500 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-stethoscope text-white text-2xl"></i>
                            </div>
                            <h3 class="font-bold text-lg mb-2">หมวดเครื่องมือแพทย์</h3>
                            <p class="text-gray-600 text-sm mb-4">งานบำรุงรักษาเครื่องมือแพทย์</p>
                            <div class="space-y-2">
                                <div class="flex justify-between text-sm">
                                    <span>พนักงาน:</span>
                                    <span class="font-semibold">3 คน</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span>มาทำงาน:</span>
                                    <span class="text-green-600 font-semibold">3 คน</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Reports Section -->
        <div id="reports" class="section hidden">
            <div class="bg-white rounded-2xl card-shadow p-8">
                <h2 class="text-2xl font-bold mb-8 flex items-center">
                    <i class="fas fa-chart-bar text-blue-600 mr-3"></i>
                    รายงานและสถิติ
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-6 rounded-xl hover-scale">
                        <div class="flex items-center justify-between mb-4">
                            <h4 class="font-semibold text-lg">รายงานการเข้างาน</h4>
                            <i class="fas fa-user-check text-2xl opacity-80"></i>
                        </div>
                        <p class="text-blue-100 text-sm mb-4">สรุปการเข้างานรายเดือน พร้อมสถิติการมาสาย</p>
                        <button class="bg-white bg-opacity-20 text-white px-4 py-2 rounded-lg hover:bg-opacity-30 transition w-full">
                            <i class="fas fa-download mr-2"></i>ดาวน์โหลด PDF
                        </button>
                    </div>
                    <div class="bg-gradient-to-r from-green-500 to-green-600 text-white p-6 rounded-xl hover-scale">
                        <div class="flex items-center justify-between mb-4">
                            <h4 class="font-semibold text-lg">รายงานการลางาน</h4>
                            <i class="fas fa-calendar-alt text-2xl opacity-80"></i>
                        </div>
                        <p class="text-green-100 text-sm mb-4">สรุปการลางานแยกตามประเภทและหมวดงาน</p>
                        <button class="bg-white bg-opacity-20 text-white px-4 py-2 rounded-lg hover:bg-opacity-30 transition w-full">
                            <i class="fas fa-download mr-2"></i>ดาวน์โหลด Excel
                        </button>
                    </div>
                    <div class="bg-gradient-to-r from-purple-500 to-purple-600 text-white p-6 rounded-xl hover-scale">
                        <div class="flex items-center justify-between mb-4">
                            <h4 class="font-semibold text-lg">รายงานสรุปรวม</h4>
                            <i class="fas fa-chart-pie text-2xl opacity-80"></i>
                        </div>
                        <p class="text-purple-100 text-sm mb-4">รายงานภาพรวมทั้งหมดพร้อมกราฟและแผนภูมิ</p>
                        <button class="bg-white bg-opacity-20 text-white px-4 py-2 rounded-lg hover:bg-opacity-30 transition w-full">
                            <i class="fas fa-download mr-2"></i>ดาวน์โหลด PDF
                        </button>
                    </div>
                </div>

                <!-- Filter Options -->
                <div class="bg-gray-50 p-6 rounded-xl mb-8">
                    <h4 class="font-semibold mb-4 flex items-center">
                        <i class="fas fa-filter text-gray-600 mr-2"></i>
                        ตัวกรองรายงาน
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
                        <select class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white shadow-sm">
                            <option>เลือกหมวดงาน</option>
                            <option>หมวดไฟฟ้า</option>
                            <option>หมวดเชื่อม</option>
                            <option>หมวดโยธาและประมาณราคา</option>
                            <option>หมวดประปา</option>
                            <option>หมวดไม้</option>
                            <option>หมวดเครื่องปรับอากาศ</option>
                            <option>หมวดธุรการ</option>
                            <option>หมวดเครื่องมือแพทย์</option>
                        </select>
                        <select class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white shadow-sm">
                            <option>ประเภทพนักงาน</option>
                            <option>พนักงานราชการ</option>
                            <option>ราชการ</option>
                            <option>พนักงานกระทรวงสาธารณะสุข</option>
                            <option>ลูกจ้าง</option>
                        </select>
                        <input type="month" class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white shadow-sm">
                        <select class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white shadow-sm">
                            <option>ประเภทรายงาน</option>
                            <option>การเข้างาน</option>
                            <option>การลางาน</option>
                            <option>การมาสาย</option>
                            <option>ภาพรวม</option>
                        </select>
                        <button class="bg-blue-500 text-white px-4 py-3 rounded-lg hover:bg-blue-600 transition font-medium">
                            <i class="fas fa-search mr-2"></i>สร้างรายงาน
                        </button>
                    </div>
                </div>

                <!-- Sample Chart Area -->
                <div class="bg-gray-50 p-8 rounded-xl text-center">
                    <h4 class="font-semibold mb-6 text-xl">กราฟสถิติการเข้างาน (เดือนนี้)</h4>
                    <div class="h-80 flex items-center justify-center">
                        <div class="text-gray-500">
                            <i class="fas fa-chart-bar text-6xl mb-4"></i>
                            <p class="text-lg">กราฟจะแสดงที่นี่เมื่อเลือกข้อมูลและกดสร้างรายงาน</p>
                            <p class="text-sm text-gray-400 mt-2">รองรับการแสดงผลแบบ Chart.js และ D3.js</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Leave Balance Management Modal -->
    <div id="leaveBalanceModal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden items-center justify-center z-50">
        <div class="bg-white rounded-2xl p-8 w-full max-w-4xl mx-4 max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold flex items-center">
                    <i class="fas fa-calendar-edit text-blue-600 mr-3"></i>
                    จัดการวันลาพักร้อน
                </h3>
                <button onclick="hideLeaveBalanceModal()" class="text-gray-500 hover:text-gray-700 text-2xl">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Employee List -->
                <div>
                    <h4 class="font-semibold mb-4 flex items-center">
                        <i class="fas fa-users text-gray-600 mr-2"></i>
                        รายชื่อพนักงาน
                    </h4>
                    <div class="space-y-3 max-h-96 overflow-y-auto">
                        <div class="employee-balance-card border border-gray-200 rounded-xl p-4 hover:shadow-md transition-shadow cursor-pointer" onclick="selectEmployeeForBalance('emp1')">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='40' height='40' viewBox='0 0 40 40'%3E%3Ccircle cx='20' cy='20' r='20' fill='%2310b981'/%3E%3Ctext x='20' y='26' text-anchor='middle' fill='white' font-size='12'%3E%E0%B8%AA%E0%B8%A1%3C/text%3E%3C/svg%3E" class="w-10 h-10 rounded-full mr-3">
                                    <div>
                                        <p class="font-semibold">นายสมชาย ใจดี</p>
                                        <p class="text-sm text-gray-600">พนักงานราชการ - หมวดไฟฟ้า</p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <p class="text-lg font-bold text-blue-600">8/10</p>
                                    <p class="text-xs text-gray-500">วันลาคงเหลือ</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="employee-balance-card border border-gray-200 rounded-xl p-4 hover:shadow-md transition-shadow cursor-pointer" onclick="selectEmployeeForBalance('emp2')">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='40' height='40' viewBox='0 0 40 40'%3E%3Ccircle cx='20' cy='20' r='20' fill='%233b82f6'/%3E%3Ctext x='20' y='26' text-anchor='middle' fill='white' font-size='12'%3E%E0%B8%A1%E0%B8%B2%3C/text%3E%3C/svg%3E" class="w-10 h-10 rounded-full mr-3">
                                    <div>
                                        <p class="font-semibold">นางสาวมาลี รักงาน</p>
                                        <p class="text-sm text-gray-600">ราชการ - หมวดธุรการ</p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <p class="text-lg font-bold text-blue-600">10/10</p>
                                    <p class="text-xs text-gray-500">วันลาคงเหลือ</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="employee-balance-card border border-gray-200 rounded-xl p-4 hover:shadow-md transition-shadow cursor-pointer" onclick="selectEmployeeForBalance('emp3')">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='40' height='40' viewBox='0 0 40 40'%3E%3Ccircle cx='20' cy='20' r='20' fill='%23f59e0b'/%3E%3Ctext x='20' y='26' text-anchor='middle' fill='white' font-size='12'%3E%E0%B8%9B%E0%B8%A3%3C/text%3E%3C/svg%3E" class="w-10 h-10 rounded-full mr-3">
                                    <div>
                                        <p class="font-semibold">นายประยุทธ์ ขยัน</p>
                                        <p class="text-sm text-gray-600">พนักงานกระทรวงฯ - หมวดเชื่อม</p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <p class="text-lg font-bold text-blue-600">4/6</p>
                                    <p class="text-xs text-gray-500">วันลาคงเหลือ</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="employee-balance-card border border-gray-200 rounded-xl p-4 hover:shadow-md transition-shadow cursor-pointer" onclick="selectEmployeeForBalance('emp4')">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='40' height='40' viewBox='0 0 40 40'%3E%3Ccircle cx='20' cy='20' r='20' fill='%236b7280'/%3E%3Ctext x='20' y='26' text-anchor='middle' fill='white' font-size='12'%3E%E0%B8%AA%E0%B8%A8%3C/text%3E%3C/svg%3E" class="w-10 h-10 rounded-full mr-3">
                                    <div>
                                        <p class="font-semibold">นายสมศักดิ์ มั่นคง</p>
                                        <p class="text-sm text-gray-600">ลูกจ้าง - หมวดโยธา</p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <p class="text-lg font-bold text-blue-600">6/6</p>
                                    <p class="text-xs text-gray-500">วันลาคงเหลือ</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Balance Editor -->
                <div>
                    <h4 class="font-semibold mb-4 flex items-center">
                        <i class="fas fa-edit text-gray-600 mr-2"></i>
                        แก้ไขวันลาพักร้อน
                    </h4>
                    <div id="balanceEditor" class="bg-gray-50 p-6 rounded-xl">
                        <p class="text-gray-500 text-center py-8">
                            <i class="fas fa-hand-pointer text-3xl mb-3 block"></i>
                            เลือกพนักงานเพื่อแก้ไขวันลา
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Employee Modal -->
    <div id="addEmployeeModal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden items-center justify-center z-50">
        <div class="bg-white rounded-2xl p-8 w-full max-w-2xl mx-4 max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold flex items-center">
                    <i class="fas fa-user-plus text-blue-600 mr-3"></i>
                    เพิ่มพนักงานใหม่
                </h3>
                <button onclick="hideAddEmployeeModal()" class="text-gray-500 hover:text-gray-700 text-2xl">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="addEmployeeForm" class="space-y-6">
                <!-- Photo Upload -->
                <div class="text-center">
                    <div class="relative inline-block">
                        <img id="photoPreview" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='120' viewBox='0 0 120 120'%3E%3Ccircle cx='60' cy='60' r='60' fill='%23e5e7eb'/%3E%3Ctext x='60' y='70' text-anchor='middle' fill='%236b7280' font-size='16'%3E%E0%B9%84%E0%B8%A1%E0%B9%88%E0%B8%A1%E0%B8%B5%E0%B8%A3%E0%B8%B9%E0%B8%9B%3C/text%3E%3C/svg%3E" class="w-32 h-32 rounded-full object-cover border-4 border-gray-200">
                        <label for="photoInput" class="absolute bottom-0 right-0 bg-blue-500 text-white p-2 rounded-full cursor-pointer hover:bg-blue-600 transition">
                            <i class="fas fa-camera"></i>
                        </label>
                        <input type="file" id="photoInput" class="hidden" accept="image/*" onchange="previewPhoto(this)">
                    </div>
                    <p class="text-sm text-gray-600 mt-2">คลิกเพื่อเพิ่มรูปถ่าย</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">ชื่อ-นามสกุล *</label>
                        <input type="text" name="name" required class="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 shadow-sm" placeholder="เช่น นายสมชาย ใจดี">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">รหัสพนักงาน *</label>
                        <input type="text" name="employeeId" required class="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 shadow-sm" placeholder="เช่น EMP001">
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">ตำแหน่ง *</label>
                        <input type="text" name="position" required class="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 shadow-sm" placeholder="เช่น หัวหน้างาน, ช่าง, เจ้าหน้าที่">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">หมวดงาน *</label>
                        <select name="department" required class="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 bg-white shadow-sm">
                            <option value="">-- เลือกหมวดงาน --</option>
                            <option value="หมวดไฟฟ้า">หมวดไฟฟ้า</option>
                            <option value="หมวดเชื่อม">หมวดเชื่อม</option>
                            <option value="หมวดโยธาและประมาณราคา">หมวดโยธาและประมาณราคา</option>
                            <option value="หมวดประปา">หมวดประปา</option>
                            <option value="หมวดไม้">หมวดไม้</option>
                            <option value="หมวดเครื่องปรับอากาศ">หมวดเครื่องปรับอากาศ</option>
                            <option value="หมวดธุรการ">หมวดธุรการ</option>
                            <option value="หมวดเครื่องมือแพทย์">หมวดเครื่องมือแพทย์</option>
                        </select>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">ประเภทการจ้าง *</label>
                        <select name="employeeType" required class="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 bg-white shadow-sm">
                            <option value="">-- เลือกประเภทการจ้าง --</option>
                            <option value="พนักงานราชการ">พนักงานราชการ</option>
                            <option value="ราชการ">ราชการ</option>
                            <option value="พนักงานกระทรวงสาธารณะสุข">พนักงานกระทรวงสาธารณะสุข</option>
                            <option value="ลูกจ้าง">ลูกจ้าง</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">เบอร์โทรศัพท์</label>
                        <input type="tel" name="phone" class="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 shadow-sm" placeholder="เช่น 081-234-5678">
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">รายละเอียดงาน</label>
                    <textarea name="jobDescription" rows="3" class="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 shadow-sm" placeholder="เช่น งานไฟฟ้าแรงสูง, งานบำรุงรักษาเครื่องมือ, งานสารบรรณ"></textarea>
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">ที่อยู่</label>
                    <textarea name="address" rows="2" class="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 shadow-sm" placeholder="ที่อยู่ปัจจุบัน"></textarea>
                </div>

                <div class="flex space-x-4 pt-6">
                    <button type="submit" class="flex-1 bg-gradient-to-r from-blue-500 to-blue-600 text-white py-4 px-6 rounded-xl font-semibold hover:from-blue-600 hover:to-blue-700 transition-all transform hover:scale-105 shadow-lg">
                        <i class="fas fa-save mr-2"></i>บันทึกข้อมูล
                    </button>
                    <button type="button" onclick="hideAddEmployeeModal()" class="flex-1 bg-gray-500 text-white py-4 px-6 rounded-xl font-semibold hover:bg-gray-600 transition-all shadow-lg">
                        <i class="fas fa-times mr-2"></i>ยกเลิก
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // 🔥 Firebase Configuration - เชื่อมต่อแล้ว! 🔥
        const firebaseConfig = {
            apiKey: "AIzaSyAZ0kJ527HIdA19TW6iPZLRWJpsBTum5nU",
            authDomain: "leave-system-2df5a.firebaseapp.com",
            projectId: "leave-system-2df5a",
            storageBucket: "leave-system-2df5a.firebasestorage.app",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "1:YOUR_SENDER_ID:web:1c902131e8df61a6463c01",
            measurementId: "G-V780LJYLH6"
        };

        // Initialize Firebase
        let db, storage;
        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            storage = firebase.storage();
            console.log('Firebase initialized successfully');
        } catch (error) {
            console.error('Firebase initialization error:', error);
            db = null;
            storage = null;
        }

        // Navigation
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            
            // Show selected section
            document.getElementById(sectionId).classList.remove('hidden');
            
            // Update navigation
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('bg-white', 'text-blue-600', 'shadow-md');
                btn.classList.add('text-gray-600');
            });
            
            event.target.classList.add('bg-white', 'text-blue-600', 'shadow-md');
            event.target.classList.remove('text-gray-600');
        }

        // Clock functions
        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('th-TH');
            const dateString = now.toLocaleDateString('th-TH', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            document.getElementById('currentTime').textContent = timeString;
            document.getElementById('currentDate').textContent = dateString;
            
            const digitalClock = document.getElementById('digitalClock');
            const digitalDate = document.getElementById('digitalDate');
            if (digitalClock) digitalClock.textContent = timeString;
            if (digitalDate) digitalDate.textContent = dateString;
        }

        // Attendance functions
        async function clockIn() {
            const employee = document.getElementById('employeeSelect').value;
            if (!employee) {
                showNotification('กรุณาเลือกพนักงานก่อน', 'warning');
                return;
            }
            
            const now = new Date();
            const timeString = now.toLocaleTimeString('th-TH', {
                hour: '2-digit',
                minute: '2-digit'
            });
            
            // บันทึกลง Firebase
            await saveAttendance(employee, 'in', now);
            
            showNotification(`บันทึกเวลาเข้างานเรียบร้อย เวลา: ${timeString}`, 'success');
            
            // Add to today's records
            addTodayRecord(employee, timeString, 'in');
            
            // รีเฟรชข้อมูลหลังบันทึกเวลา
            await refreshAllData();
        }

        async function clockOut() {
            const employee = document.getElementById('employeeSelect').value;
            if (!employee) {
                showNotification('กรุณาเลือกพนักงานก่อน', 'warning');
                return;
            }
            
            const now = new Date();
            const timeString = now.toLocaleTimeString('th-TH', {
                hour: '2-digit',
                minute: '2-digit'
            });
            
            // บันทึกลง Firebase
            await saveAttendance(employee, 'out', now);
            
            showNotification(`บันทึกเวลาออกงานเรียบร้อย เวลา: ${timeString}`, 'success');
            
            // Add to today's records
            addTodayRecord(employee, timeString, 'out');
            
            // รีเฟรชข้อมูลหลังบันทึกเวลา
            await refreshAllData();
        }

        function addTodayRecord(employeeId, time, type) {
            const recordsDiv = document.getElementById('todayRecords');
            const employeeName = document.getElementById('employeeSelect').selectedOptions[0].text.split(' - ')[0];
            
            const newRecord = document.createElement('div');
            newRecord.className = `flex items-center justify-between p-3 ${type === 'in' ? 'bg-green-50 border-l-4 border-green-500' : 'bg-red-50 border-l-4 border-red-500'} rounded-lg`;
            newRecord.innerHTML = `
                <div class="flex items-center">
                    <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 32 32'%3E%3Ccircle cx='16' cy='16' r='16' fill='%23${type === 'in' ? '10b981' : 'ef4444'}'/%3E%3Ctext x='16' y='21' text-anchor='middle' fill='white' font-size='10'%3E${employeeName.charAt(3)}%3C/text%3E%3C/svg%3E" class="w-8 h-8 rounded-full mr-3">
                    <div>
                        <p class="font-medium text-sm">${employeeName}</p>
                        <p class="text-xs text-gray-600">หมวดงาน</p>
                    </div>
                </div>
                <div class="text-right">
                    <p class="text-sm font-semibold ${type === 'in' ? 'text-green-600' : 'text-red-600'}">${type === 'in' ? 'เข้า' : 'ออก'}: ${time}</p>
                    <p class="text-xs text-gray-500">${type === 'in' ? 'ตรงเวลา' : 'ปกติ'}</p>
                </div>
            `;
            recordsDiv.insertBefore(newRecord, recordsDiv.firstChild);
        }

        // Modal functions
        function showAddEmployeeModal() {
            document.getElementById('addEmployeeModal').classList.remove('hidden');
            document.getElementById('addEmployeeModal').classList.add('flex');
            
            // รีเซ็ตฟอร์มและหัวข้อเมื่อเปิด modal ใหม่
            if (!editingEmployeeId) {
                document.querySelector('#addEmployeeModal h3').innerHTML = `
                    <i class="fas fa-user-plus text-blue-600 mr-3"></i>
                    เพิ่มพนักงานใหม่
                `;
                const submitBtn = document.querySelector('#addEmployeeForm button[type="submit"]');
                submitBtn.innerHTML = '<i class="fas fa-save mr-2"></i>บันทึกข้อมูล';
            }
        }

        function hideAddEmployeeModal() {
            document.getElementById('addEmployeeModal').classList.add('hidden');
            document.getElementById('addEmployeeModal').classList.remove('flex');
            
            // รีเซ็ตตัวแปรแก้ไข
            editingEmployeeId = null;
            
            // รีเซ็ตฟอร์ม
            document.getElementById('addEmployeeForm').reset();
            document.getElementById('photoPreview').src = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='120' viewBox='0 0 120 120'%3E%3Ccircle cx='60' cy='60' r='60' fill='%23e5e7eb'/%3E%3Ctext x='60' y='70' text-anchor='middle' fill='%236b7280' font-size='16'%3E%E0%B9%84%E0%B8%A1%E0%B9%88%E0%B8%A1%E0%B8%B5%E0%B8%A3%E0%B8%B9%E0%B8%9B%3C/text%3E%3C/svg%3E";
        }

        // Refresh all data function
        async function refreshAllData() {
            try {
                // แสดง loading
                showNotification('กำลังอัพเดตข้อมูล...', 'info');
                
                // รีโหลดข้อมูลทั้งหมด
                await loadAllData();
                
                console.log('All data refreshed successfully');
                
            } catch (error) {
                console.error('Error refreshing data:', error);
                showNotification('เกิดข้อผิดพลาดในการอัพเดตข้อมูล', 'error');
            }
        }

        // Photo preview function
        function previewPhoto(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('photoPreview').src = e.target.result;
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        // Notification function
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 p-4 rounded-xl shadow-lg transform transition-all duration-300 translate-x-full`;
            
            const colors = {
                success: 'bg-green-500 text-white',
                warning: 'bg-yellow-500 text-white',
                error: 'bg-red-500 text-white',
                info: 'bg-blue-500 text-white'
            };
            
            notification.classList.add(...colors[type].split(' '));
            notification.innerHTML = `
                <div class="flex items-center">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'warning' ? 'exclamation-triangle' : type === 'error' ? 'times-circle' : 'info-circle'} mr-2"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Animate in
            setTimeout(() => {
                notification.classList.remove('translate-x-full');
            }, 100);
            
            // Animate out and remove
            setTimeout(() => {
                notification.classList.add('translate-x-full');
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // Form submission
        document.getElementById('leaveForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const employeeSelect = document.getElementById('leaveEmployeeSelect');
            const leaveTypeSelect = document.getElementById('leaveTypeSelect');
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            const reason = this.querySelector('textarea').value;
            const leaveDays = parseInt(document.getElementById('leaveDaysCount').textContent) || 0;
            
            if (!employeeSelect.value) {
                showNotification('กรุณาเลือกพนักงาน', 'warning');
                return;
            }
            
            if (!leaveTypeSelect.value) {
                showNotification('กรุณาเลือกประเภทการลา', 'warning');
                return;
            }
            
            if (leaveDays === 0) {
                showNotification('กรุณาเลือกวันที่ลา', 'warning');
                return;
            }
            
            if (!reason.trim()) {
                showNotification('กรุณาระบุเหตุผลการลา', 'warning');
                return;
            }
            
            // Check vacation leave balance
            if (leaveTypeSelect.value === 'vacation') {
                const empData = employeeLeaveData[employeeSelect.value];
                if (empData && leaveDays > empData.remaining) {
                    showNotification('วันลาพักร้อนไม่เพียงพอ กรุณาตรวจสอบวันลาคงเหลือ', 'error');
                    return;
                }
            }
            
            // สร้างข้อมูลคำขอลา
            const leaveData = {
                employeeId: employeeSelect.value,
                employeeName: employeeSelect.selectedOptions[0].text.split(' - ')[0],
                leaveType: leaveTypeSelect.value,
                startDate: startDate,
                endDate: endDate,
                leaveDays: leaveDays,
                reason: reason,
                requestDate: new Date().toISOString()
            };
            
            // บันทึกลง Firebase
            await saveLeaveRequest(leaveData);
            
            // อัพเดตวันลาพักร้อนถ้าจำเป็น
            if (leaveTypeSelect.value === 'vacation') {
                const empData = employeeLeaveData[employeeSelect.value];
                if (empData) {
                    empData.remaining -= leaveDays;
                    empData.used += leaveDays;
                    updateLeaveBalanceDisplay();
                    updateLeaveBalance();
                    
                    // บันทึกการเปลี่ยนแปลงวันลาลง Firebase
                    await updateLeaveBalanceInDB(employeeSelect.value, empData.remaining, `ลาพักร้อน ${leaveDays} วัน`);
                }
            }
            
            showNotification(`ส่งคำขอลางานเรียบร้อยแล้ว (${leaveDays} วัน) รอการอนุมัติ`, 'success');
            this.reset();
            document.getElementById('leaveDaysCount').textContent = '0';
            document.getElementById('leaveWarning').classList.add('hidden');
            
            // รีเฟรชข้อมูลหลังส่งคำขอลา
            await refreshAllData();
        });

        // Employee form submission
        document.getElementById('addEmployeeForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Get form values using FormData
            const formData = new FormData(this);
            const photoFile = document.getElementById('photoInput').files[0];
            
            // Validate required fields
            const name = formData.get('name').trim();
            const employeeId = formData.get('employeeId').trim();
            const position = formData.get('position').trim();
            const department = formData.get('department');
            const employeeType = formData.get('employeeType');
            
            if (!name || !employeeId || !position || !department || !employeeType) {
                showNotification('กรุณากรอกข้อมูลที่จำเป็นให้ครบถ้วน', 'warning');
                return;
            }
            
            try {
                let photoURL = null;
                
                // ถ้าเป็นการแก้ไขและไม่ได้เลือกรูปใหม่ ให้ใช้รูปเดิม
                if (editingEmployeeId && !photoFile) {
                    const existingEmployee = allEmployees.find(emp => emp.id === editingEmployeeId);
                    photoURL = existingEmployee?.photoURL || null;
                } else if (photoFile) {
                    photoURL = await uploadPhoto(photoFile);
                }
                
                const employeeData = {
                    name: name,
                    employeeId: employeeId,
                    position: position,
                    department: department,
                    employeeType: employeeType,
                    phone: formData.get('phone') ? formData.get('phone').trim() : '',
                    jobDescription: formData.get('jobDescription') ? formData.get('jobDescription').trim() : '',
                    address: formData.get('address') ? formData.get('address').trim() : '',
                    photoURL: photoURL,
                    status: 'active'
                };
                
                if (editingEmployeeId) {
                    // แก้ไขพนักงาน
                    console.log('Updating employee data:', employeeData);
                    await updateEmployee(editingEmployeeId, employeeData);
                } else {
                    // เพิ่มพนักงานใหม่
                    console.log('Saving new employee data:', employeeData);
                    await saveEmployee(employeeData);
                }
                
                // Reset form and close modal
                hideAddEmployeeModal();
                
                // รีเฟรชข้อมูลทั้งหมด
                await refreshAllData();
                
            } catch (error) {
                console.error('Error saving employee:', error);
                showNotification('เกิดข้อผิดพลาดในการบันทึกข้อมูล: ' + error.message, 'error');
            }
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', async function() {
            updateTime();
            setInterval(updateTime, 1000);
            
            // แสดงสถานะการเชื่อมต่อ Firebase
            console.log('Firebase connection status:', {
                app: !!firebase.apps.length,
                db: !!db,
                storage: !!storage
            });
            
            // โหลดข้อมูลทั้งหมดและอัพเดตแดชบอร์ด
            console.log('Starting to load all data...');
            await loadAllData();
            
            // Show welcome notification
            setTimeout(() => {
                if (db) {
                    showNotification('เชื่อมต่อ Firebase สำเร็จ! พร้อมใช้งาน', 'success');
                } else {
                    showNotification('ทำงานในโหมด Demo - ตั้งค่า Firebase เพื่อบันทึกข้อมูลจริง', 'info');
                }
            }, 1000);
        });

        // Load all data and update dashboard
        async function loadAllData() {
            try {
                showNotification('กำลังโหลดข้อมูล...', 'info');
                
                // โหลดข้อมูลพนักงาน
                await loadEmployees();
                await loadEmployeeList();
                
                // โหลดข้อมูลการเข้างานและการลา
                await loadAttendanceData();
                await loadLeaveData();
                
                // อัพเดตแดชบอร์ด
                await updateDashboardStats();
                
                console.log('All data loaded successfully');
                
            } catch (error) {
                console.error('Error loading all data:', error);
                showNotification('เกิดข้อผิดพลาดในการโหลดข้อมูล', 'error');
            }
        }

        // Real-time dashboard statistics
        let attendanceData = [];
        let leaveData = [];

        async function loadAttendanceData() {
            try {
                if (!db) {
                    // Demo data
                    attendanceData = generateDemoAttendanceData();
                    return;
                }
                
                const today = new Date().toISOString().split('T')[0];
                const snapshot = await db.collection('attendance')
                    .where('date', '==', today)
                    .get();
                
                attendanceData = [];
                snapshot.forEach(doc => {
                    attendanceData.push({ id: doc.id, ...doc.data() });
                });
                
                console.log('Attendance data loaded:', attendanceData.length);
                
            } catch (error) {
                console.error('Error loading attendance data:', error);
                attendanceData = generateDemoAttendanceData();
            }
        }

        async function loadLeaveData() {
            try {
                if (!db) {
                    // Demo data
                    leaveData = generateDemoLeaveData();
                    return;
                }
                
                const today = new Date().toISOString().split('T')[0];
                const snapshot = await db.collection('leave_requests')
                    .where('startDate', '<=', today)
                    .where('endDate', '>=', today)
                    .where('status', '==', 'approved')
                    .get();
                
                leaveData = [];
                snapshot.forEach(doc => {
                    leaveData.push({ id: doc.id, ...doc.data() });
                });
                
                console.log('Leave data loaded:', leaveData.length);
                
            } catch (error) {
                console.error('Error loading leave data:', error);
                leaveData = generateDemoLeaveData();
            }
        }

        function generateDemoAttendanceData() {
            const demoData = [];
            const activeEmployees = allEmployees.filter(emp => emp.status === 'active');
            
            // สร้างข้อมูลการเข้างานจำลอง (80-95% ของพนักงาน)
            const attendanceRate = 0.85 + Math.random() * 0.1; // 85-95%
            const attendingCount = Math.floor(activeEmployees.length * attendanceRate);
            
            for (let i = 0; i < attendingCount; i++) {
                if (activeEmployees[i]) {
                    const isLate = Math.random() < 0.08; // 8% มาสาย
                    const clockInTime = isLate ? 
                        new Date(2024, 0, 1, 8, 15 + Math.floor(Math.random() * 30)) : // สาย 15-45 นาที
                        new Date(2024, 0, 1, 7, 45 + Math.floor(Math.random() * 30)); // ตรงเวลา 7:45-8:15
                    
                    demoData.push({
                        employeeId: activeEmployees[i].id,
                        type: 'in',
                        timestamp: clockInTime,
                        isLate: isLate
                    });
                }
            }
            
            return demoData;
        }

        function generateDemoLeaveData() {
            const demoData = [];
            const activeEmployees = allEmployees.filter(emp => emp.status === 'active');
            
            // สร้างข้อมูลการลาจำลอง (5-15% ของพนักงาน)
            const leaveRate = 0.05 + Math.random() * 0.1; // 5-15%
            const leaveCount = Math.floor(activeEmployees.length * leaveRate);
            
            const leaveTypes = ['sick', 'personal', 'vacation'];
            
            for (let i = 0; i < leaveCount; i++) {
                if (activeEmployees[i]) {
                    demoData.push({
                        employeeId: activeEmployees[i].id,
                        leaveType: leaveTypes[Math.floor(Math.random() * leaveTypes.length)],
                        status: 'approved'
                    });
                }
            }
            
            return demoData;
        }

        async function updateDashboardStats() {
            try {
                const totalEmployees = allEmployees.length;
                const activeEmployees = allEmployees.filter(emp => emp.status === 'active');
                
                // คำนวณสถิติจากข้อมูลจริง
                const attendingToday = attendanceData.filter(att => att.type === 'in').length;
                const lateToday = attendanceData.filter(att => att.isLate).length;
                const onLeaveToday = leaveData.length;
                
                // อัพเดต Stats Cards
                updateStatCard('มาทำงานวันนี้', attendingToday, 'green', `↑ ${Math.round((attendingToday/activeEmployees.length)*100)}% จากทั้งหมด`);
                updateStatCard('ลางานวันนี้', onLeaveToday, 'red', getLeaveBreakdown());
                updateStatCard('มาสาย', lateToday, 'yellow', lateToday > 0 ? `${Math.round((lateToday/attendingToday)*100)}% ของผู้เข้างาน` : 'ไม่มีผู้มาสาย');
                updateStatCard('พนักงานทั้งหมด', totalEmployees, 'blue', `${getDepartmentCount()} หมวดงาน`);
                
                // อัพเดตสถานะหมวดงาน
                updateDepartmentStatus();
                
                // อัพเดตกิจกรรมล่าสุด
                updateRecentActivity();
                
                console.log('Dashboard stats updated');
                
            } catch (error) {
                console.error('Error updating dashboard stats:', error);
            }
        }

        function updateStatCard(title, value, color, subtitle) {
            const cards = document.querySelectorAll('.grid .bg-white.p-6.rounded-2xl');
            
            cards.forEach(card => {
                const titleElement = card.querySelector('p.text-gray-600');
                if (titleElement && titleElement.textContent === title) {
                    const valueElement = card.querySelector('p.text-3xl');
                    const subtitleElement = card.querySelector('p.text-xs');
                    
                    if (valueElement) valueElement.textContent = value;
                    if (subtitleElement) subtitleElement.textContent = subtitle;
                }
            });
        }

        function getLeaveBreakdown() {
            const sickLeave = leaveData.filter(leave => leave.leaveType === 'sick').length;
            const personalLeave = leaveData.filter(leave => leave.leaveType === 'personal').length;
            const vacationLeave = leaveData.filter(leave => leave.leaveType === 'vacation').length;
            
            const breakdown = [];
            if (sickLeave > 0) breakdown.push(`${sickLeave} ลาป่วย`);
            if (personalLeave > 0) breakdown.push(`${personalLeave} ลากิจ`);
            if (vacationLeave > 0) breakdown.push(`${vacationLeave} ลาพักร้อน`);
            
            return breakdown.length > 0 ? breakdown.join(', ') : 'ไม่มีผู้ลางาน';
        }

        function getDepartmentCount() {
            const departments = [...new Set(allEmployees.map(emp => emp.department).filter(dept => dept))];
            return departments.length;
        }

        function updateDepartmentStatus() {
            const departments = [
                { name: 'หมวดไฟฟ้า', icon: 'fas fa-bolt', color: 'blue' },
                { name: 'หมวดเชื่อม', icon: 'fas fa-fire', color: 'orange' },
                { name: 'หมวดโยธาและประมาณราคา', icon: 'fas fa-hammer', color: 'gray' },
                { name: 'หมวดประปา', icon: 'fas fa-tint', color: 'cyan' },
                { name: 'หมวดไม้', icon: 'fas fa-tree', color: 'amber' },
                { name: 'หมวดเครื่องปรับอากาศ', icon: 'fas fa-snowflake', color: 'indigo' },
                { name: 'หมวดธุรการ', icon: 'fas fa-file-alt', color: 'purple' },
                { name: 'หมวดเครื่องมือแพทย์', icon: 'fas fa-stethoscope', color: 'emerald' }
            ];
            
            const departmentContainer = document.querySelector('#dashboard .bg-white.rounded-2xl.card-shadow .space-y-4');
            if (!departmentContainer) return;
            
            departmentContainer.innerHTML = '';
            
            departments.forEach(dept => {
                const deptEmployees = allEmployees.filter(emp => emp.department === dept.name);
                const attendingEmployees = attendanceData.filter(att => {
                    const employee = allEmployees.find(emp => emp.id === att.employeeId);
                    return employee && employee.department === dept.name && att.type === 'in';
                });
                
                const total = deptEmployees.length;
                const attending = attendingEmployees.length;
                const attendanceRate = total > 0 ? (attending / total) : 0;
                
                let statusColor = 'green';
                let statusIcon = 'green';
                if (attendanceRate < 0.8) {
                    statusColor = 'red';
                    statusIcon = 'red';
                } else if (attendanceRate < 1) {
                    statusColor = 'yellow';
                    statusIcon = 'yellow';
                }
                
                if (total > 0) {
                    const departmentCard = document.createElement('div');
                    departmentCard.className = `department-card p-4 rounded-lg bg-gray-50 border-${dept.color}-500`;
                    departmentCard.innerHTML = `
                        <div class="flex justify-between items-center">
                            <div class="flex items-center">
                                <i class="${dept.icon} text-${dept.color}-600 mr-3"></i>
                                <span class="font-medium">${dept.name}</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="bg-${statusColor}-100 text-${statusColor}-800 px-2 py-1 rounded-full text-xs">${attending}/${total} คน</span>
                                <span class="status-badge w-3 h-3 bg-${statusIcon}-500 rounded-full"></span>
                            </div>
                        </div>
                    `;
                    departmentContainer.appendChild(departmentCard);
                }
            });
        }

        function updateRecentActivity() {
            const activityContainer = document.querySelector('#dashboard .space-y-4.max-h-80.overflow-y-auto');
            if (!activityContainer) return;
            
            activityContainer.innerHTML = '';
            
            // รวมกิจกรรมทั้งหมด
            const activities = [];
            
            // เพิ่มกิจกรรมการเข้างาน
            attendanceData.forEach(att => {
                const employee = allEmployees.find(emp => emp.id === att.employeeId);
                if (employee) {
                    activities.push({
                        type: att.type,
                        employee: employee,
                        time: att.timestamp,
                        isLate: att.isLate
                    });
                }
            });
            
            // เพิ่มกิจกรรมการลา
            leaveData.forEach(leave => {
                const employee = allEmployees.find(emp => emp.id === leave.employeeId);
                if (employee) {
                    activities.push({
                        type: 'leave',
                        employee: employee,
                        leaveType: leave.leaveType,
                        time: new Date()
                    });
                }
            });
            
            // เรียงตามเวลา
            activities.sort((a, b) => new Date(b.time) - new Date(a.time));
            
            // แสดงกิจกรรม 10 รายการล่าสุด
            activities.slice(0, 10).forEach(activity => {
                const activityElement = document.createElement('div');
                const timeStr = new Date(activity.time).toLocaleTimeString('th-TH', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
                
                let bgColor, borderColor, icon, text, textColor;
                
                if (activity.type === 'in') {
                    bgColor = activity.isLate ? 'bg-yellow-50' : 'bg-green-50';
                    borderColor = activity.isLate ? 'border-yellow-500' : 'border-green-500';
                    textColor = activity.isLate ? 'text-yellow-600' : 'text-green-600';
                    icon = 'fas fa-sign-in-alt';
                    text = `เข้างาน - ${activity.employee.department}`;
                } else if (activity.type === 'out') {
                    bgColor = 'bg-red-50';
                    borderColor = 'border-red-500';
                    textColor = 'text-red-600';
                    icon = 'fas fa-sign-out-alt';
                    text = `ออกงาน - ${activity.employee.department}`;
                } else if (activity.type === 'leave') {
                    bgColor = 'bg-blue-50';
                    borderColor = 'border-blue-500';
                    textColor = 'text-blue-600';
                    icon = 'fas fa-calendar';
                    const leaveTypeText = {
                        'sick': 'ลาป่วย',
                        'personal': 'ลากิจ',
                        'vacation': 'ลาพักร้อน'
                    };
                    text = `${leaveTypeText[activity.leaveType] || 'ลางาน'} - ${activity.employee.department}`;
                }
                
                const profileImg = activity.employee.photoURL || 
                    `data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='40' height='40' viewBox='0 0 40 40'%3E%3Ccircle cx='20' cy='20' r='20' fill='%23${getRandomColor()}'/%3E%3Ctext x='20' y='26' text-anchor='middle' fill='white' font-size='12'%3E${activity.employee.name.charAt(3) || activity.employee.name.charAt(0)}%3C/text%3E%3C/svg%3E`;
                
                activityElement.className = `flex items-center p-3 ${bgColor} rounded-lg border-l-4 ${borderColor}`;
                activityElement.innerHTML = `
                    <img src="${profileImg}" class="w-10 h-10 rounded-full mr-3">
                    <div class="flex-1">
                        <p class="font-medium text-gray-800">${activity.employee.name}</p>
                        <p class="text-sm text-gray-600">${text}</p>
                        <p class="text-xs ${textColor}">${timeStr}</p>
                    </div>
                    <i class="${icon} ${textColor}"></i>
                `;
                
                activityContainer.appendChild(activityElement);
            });
            
            // ถ้าไม่มีกิจกรรม
            if (activities.length === 0) {
                activityContainer.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-clock text-3xl mb-2"></i>
                        <p>ยังไม่มีกิจกรรมวันนี้</p>
                    </div>
                `;
            }
        }

        // Leave Balance Management
        const employeeLeaveData = {
            emp1: { name: 'นายสมชาย ใจดี', type: 'พนักงานราชการ', total: 10, remaining: 8, used: 2 },
            emp2: { name: 'นางสาวมาลี รักงาน', type: 'ราชการ', total: 10, remaining: 10, used: 0 },
            emp3: { name: 'นายประยุทธ์ ขยัน', type: 'พนักงานกระทรวงสาธารณะสุข', total: 6, remaining: 4, used: 2 },
            emp4: { name: 'นายสมศักดิ์ มั่นคง', type: 'ลูกจ้าง', total: 6, remaining: 6, used: 0 }
        };

        function showLeaveBalanceModal() {
            document.getElementById('leaveBalanceModal').classList.remove('hidden');
            document.getElementById('leaveBalanceModal').classList.add('flex');
        }

        function hideLeaveBalanceModal() {
            document.getElementById('leaveBalanceModal').classList.add('hidden');
            document.getElementById('leaveBalanceModal').classList.remove('flex');
        }

        function selectEmployeeForBalance(empId) {
            // Remove previous selection
            document.querySelectorAll('.employee-balance-card').forEach(card => {
                card.classList.remove('border-blue-500', 'bg-blue-50');
            });
            
            // Add selection to clicked card
            event.currentTarget.classList.add('border-blue-500', 'bg-blue-50');
            
            const employee = employeeLeaveData[empId];
            const editor = document.getElementById('balanceEditor');
            
            editor.innerHTML = `
                <div class="space-y-6">
                    <div class="text-center">
                        <h5 class="font-bold text-lg mb-2">${employee.name}</h5>
                        <p class="text-gray-600">${employee.type}</p>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-4 text-center">
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <p class="text-2xl font-bold text-blue-600">${employee.total}</p>
                            <p class="text-sm text-blue-600">วันทั้งหมด</p>
                        </div>
                        <div class="bg-red-50 p-4 rounded-lg">
                            <p class="text-2xl font-bold text-red-600">${employee.used}</p>
                            <p class="text-sm text-red-600">วันที่ใช้แล้ว</p>
                        </div>
                        <div class="bg-green-50 p-4 rounded-lg">
                            <p class="text-2xl font-bold text-green-600">${employee.remaining}</p>
                            <p class="text-sm text-green-600">วันคงเหลือ</p>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">ปรับวันลาคงเหลือ</label>
                        <div class="flex items-center space-x-3">
                            <button onclick="adjustLeaveBalance('${empId}', -1)" class="bg-red-500 text-white w-10 h-10 rounded-full hover:bg-red-600 transition">
                                <i class="fas fa-minus"></i>
                            </button>
                            <input type="number" id="balance_${empId}" value="${employee.remaining}" min="0" max="${employee.total}" class="flex-1 p-3 border border-gray-300 rounded-lg text-center font-bold text-lg">
                            <button onclick="adjustLeaveBalance('${empId}', 1)" class="bg-green-500 text-white w-10 h-10 rounded-full hover:bg-green-600 transition">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        <p class="text-xs text-gray-500 mt-2">สามารถปรับได้ 0-${employee.total} วัน</p>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">เหตุผลการปรับ</label>
                        <textarea id="reason_${empId}" rows="3" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="ระบุเหตุผลการปรับวันลา เช่น ลาป่วยโดยไม่หักวันลาพักร้อน, ปรับยอดคงเหลือ"></textarea>
                    </div>
                    
                    <div class="flex space-x-3">
                        <button onclick="saveLeaveBalance('${empId}')" class="flex-1 bg-blue-500 text-white py-3 px-4 rounded-lg hover:bg-blue-600 transition font-semibold">
                            <i class="fas fa-save mr-2"></i>บันทึกการเปลี่ยนแปลง
                        </button>
                        <button onclick="resetLeaveBalance('${empId}')" class="flex-1 bg-gray-500 text-white py-3 px-4 rounded-lg hover:bg-gray-600 transition font-semibold">
                            <i class="fas fa-undo mr-2"></i>รีเซ็ต
                        </button>
                    </div>
                </div>
            `;
        }

        function adjustLeaveBalance(empId, change) {
            const input = document.getElementById(`balance_${empId}`);
            const currentValue = parseInt(input.value);
            const newValue = Math.max(0, Math.min(employeeLeaveData[empId].total, currentValue + change));
            input.value = newValue;
        }

        async function saveLeaveBalance(empId) {
            const newBalance = parseInt(document.getElementById(`balance_${empId}`).value);
            const reason = document.getElementById(`reason_${empId}`).value;
            
            if (!reason.trim()) {
                showNotification('กรุณาระบุเหตุผลการปรับวันลา', 'warning');
                return;
            }
            
            // Update local data
            employeeLeaveData[empId].remaining = newBalance;
            employeeLeaveData[empId].used = employeeLeaveData[empId].total - newBalance;
            
            // บันทึกลง Firebase
            await updateLeaveBalanceInDB(empId, newBalance, reason);
            
            // Update UI
            updateLeaveBalanceDisplay();
            hideLeaveBalanceModal();
            
            showNotification(`ปรับวันลาพักร้อนของ ${employeeLeaveData[empId].name} เรียบร้อย`, 'success');
            
            // รีเฟรชข้อมูลหลังปรับวันลา
            await refreshAllData();
        }

        function resetLeaveBalance(empId) {
            const employee = employeeLeaveData[empId];
            employee.remaining = employee.total;
            employee.used = 0;
            
            document.getElementById(`balance_${empId}`).value = employee.remaining;
            showNotification(`รีเซ็ตวันลาของ ${employee.name} เรียบร้อย`, 'success');
        }

        function updateLeaveBalance() {
            const select = document.getElementById('leaveEmployeeSelect');
            const selectedOption = select.options[select.selectedIndex];
            
            if (selectedOption.value) {
                const empData = employeeLeaveData[selectedOption.value];
                if (empData) {
                    document.getElementById('vacationBalance').textContent = empData.remaining;
                    document.querySelector('#vacationBalance').nextElementSibling.textContent = 
                        `วัน (จากทั้งหมด ${empData.total} วัน)`;
                }
            }
        }

        function checkLeaveEligibility() {
            const employeeSelect = document.getElementById('leaveEmployeeSelect');
            const leaveTypeSelect = document.getElementById('leaveTypeSelect');
            const warningDiv = document.getElementById('leaveWarning');
            const warningText = document.getElementById('leaveWarningText');
            
            if (employeeSelect.value && leaveTypeSelect.value === 'vacation') {
                const empData = employeeLeaveData[employeeSelect.value];
                const leaveDays = parseInt(document.getElementById('leaveDaysCount').textContent) || 0;
                
                if (leaveDays > empData.remaining) {
                    warningDiv.classList.remove('hidden');
                    warningText.textContent = `วันลาที่ขอ (${leaveDays} วัน) เกินวันลาคงเหลือ (${empData.remaining} วัน)`;
                } else if (empData.remaining <= 2) {
                    warningDiv.classList.remove('hidden');
                    warningText.textContent = `วันลาพักร้อนคงเหลือน้อย (${empData.remaining} วัน)`;
                } else {
                    warningDiv.classList.add('hidden');
                }
            } else {
                warningDiv.classList.add('hidden');
            }
        }

        function calculateLeaveDays() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            const daysCountElement = document.getElementById('leaveDaysCount');
            
            if (startDate && endDate) {
                const start = new Date(startDate);
                const end = new Date(endDate);
                
                if (end >= start) {
                    const timeDiff = end.getTime() - start.getTime();
                    const daysDiff = Math.ceil(timeDiff / (1000 * 3600 * 24)) + 1;
                    daysCountElement.textContent = daysDiff;
                    
                    // Check eligibility after calculating days
                    checkLeaveEligibility();
                } else {
                    daysCountElement.textContent = '0';
                    showNotification('วันที่สิ้นสุดต้องมากกว่าหรือเท่ากับวันที่เริ่มต้น', 'warning');
                }
            } else {
                daysCountElement.textContent = '0';
            }
        }

        function updateLeaveBalanceDisplay() {
            // Update modal display
            const cards = document.querySelectorAll('.employee-balance-card');
            cards.forEach((card, index) => {
                const empId = `emp${index + 1}`;
                const empData = employeeLeaveData[empId];
                if (empData) {
                    const balanceElement = card.querySelector('.text-lg.font-bold');
                    balanceElement.textContent = `${empData.remaining}/${empData.total}`;
                }
            });
        }

        // Employee List Functions
        let allEmployees = [];
        let filteredEmployees = [];
        let currentPage = 1;
        const itemsPerPage = 10;

        async function loadEmployeeList() {
            try {
                if (!db) {
                    console.log('Firebase not connected, using demo data');
                    loadDemoEmployeeList();
                    return;
                }
                
                console.log('Loading employee list from Firebase...');
                
                const snapshot = await db.collection('employees').get();
                
                allEmployees = [];
                snapshot.forEach(doc => {
                    const data = doc.data();
                    allEmployees.push({ id: doc.id, ...data });
                });
                
                console.log('Total employees loaded for list:', allEmployees.length);
                
                filteredEmployees = [...allEmployees];
                updateEmployeeStats();
                renderEmployeeTable();
                
                if (allEmployees.length > 0) {
                    showNotification(`โหลดรายชื่อพนักงาน ${allEmployees.length} คน`, 'success');
                } else {
                    showNotification('ไม่พบข้อมูลพนักงานในระบบ', 'info');
                }
                
            } catch (error) {
                console.error('Error loading employee list:', error);
                showNotification('เกิดข้อผิดพลาดในการโหลดรายชื่อพนักงาน: ' + error.message, 'error');
            }
        }

        function loadDemoEmployeeList() {
            allEmployees = [
                {
                    id: 'demo1',
                    name: 'นายสมชาย ใจดี',
                    employeeId: 'EMP001',
                    position: 'หัวหน้างานไฟฟ้า',
                    department: 'หมวดไฟฟ้า',
                    employeeType: 'พนักงานราชการ',
                    phone: '081-234-5678',
                    status: 'active'
                },
                {
                    id: 'demo2',
                    name: 'นางสาวมาลี รักงาน',
                    employeeId: 'EMP002',
                    position: 'เจ้าหน้าที่ธุรการ',
                    department: 'หมวดธุรการ',
                    employeeType: 'ราชการ',
                    phone: '081-345-6789',
                    status: 'active'
                },
                {
                    id: 'demo3',
                    name: 'นายประยุทธ์ ขยัน',
                    employeeId: 'EMP003',
                    position: 'ช่างเชื่อม',
                    department: 'หมวดเชื่อม',
                    employeeType: 'พนักงานกระทรวงสาธารณะสุข',
                    phone: '081-456-7890',
                    status: 'active'
                },
                {
                    id: 'demo4',
                    name: 'นายสมศักดิ์ มั่นคง',
                    employeeId: 'EMP004',
                    position: 'หัวหน้างานโยธา',
                    department: 'หมวดโยธาและประมาณราคา',
                    employeeType: 'ลูกจ้าง',
                    phone: '081-567-8901',
                    status: 'active'
                }
            ];
            
            filteredEmployees = [...allEmployees];
            updateEmployeeStats();
            renderEmployeeTable();
            showNotification('แสดงข้อมูลตัวอย่าง', 'info');
        }

        function updateEmployeeStats() {
            const total = allEmployees.length;
            const active = allEmployees.filter(emp => emp.status === 'active').length;
            const government = allEmployees.filter(emp => emp.employeeType === 'พนักงานราชการ' || emp.employeeType === 'ราชการ').length;
            const contract = allEmployees.filter(emp => emp.employeeType === 'ลูกจ้าง').length;
            
            document.getElementById('totalEmployees').textContent = total;
            document.getElementById('activeEmployees').textContent = active;
            document.getElementById('governmentEmployees').textContent = government;
            document.getElementById('contractEmployees').textContent = contract;
        }

        function filterEmployeeList() {
            const searchTerm = document.getElementById('searchEmployee').value.toLowerCase();
            const departmentFilter = document.getElementById('filterDepartment').value;
            const typeFilter = document.getElementById('filterEmployeeType').value;
            const statusFilter = document.getElementById('filterStatus').value;
            
            filteredEmployees = allEmployees.filter(emp => {
                // ตรวจสอบการค้นหา - ค้นหาได้จากชื่อ, รหัส, ตำแหน่ง
                const matchesSearch = !searchTerm || 
                    (emp.name && emp.name.toLowerCase().includes(searchTerm)) ||
                    (emp.employeeId && emp.employeeId.toLowerCase().includes(searchTerm)) ||
                    (emp.position && emp.position.toLowerCase().includes(searchTerm)) ||
                    (emp.department && emp.department.toLowerCase().includes(searchTerm));
                
                // ตรวจสอบหมวดงาน
                const matchesDepartment = !departmentFilter || emp.department === departmentFilter;
                
                // ตรวจสอบประเภทการจ้าง
                const matchesType = !typeFilter || emp.employeeType === typeFilter;
                
                // ตรวจสอบสถานะ
                const matchesStatus = !statusFilter || emp.status === statusFilter;
                
                return matchesSearch && matchesDepartment && matchesType && matchesStatus;
            });
            
            currentPage = 1;
            renderEmployeeTable();
            updateEmployeeStats(); // อัพเดตสถิติตามการกรอง
            
            // แสดงผลการกรอง
            const totalFiltered = filteredEmployees.length;
            const totalAll = allEmployees.length;
            
            if (totalFiltered < totalAll) {
                showNotification(`พบพนักงาน ${totalFiltered} คน จากทั้งหมด ${totalAll} คน`, 'info');
            }
        }

        function clearFilters() {
            document.getElementById('searchEmployee').value = '';
            document.getElementById('filterDepartment').value = '';
            document.getElementById('filterEmployeeType').value = '';
            document.getElementById('filterStatus').value = '';
            
            // ซ่อนสรุปการกรอง
            document.getElementById('filterSummary').classList.add('hidden');
            
            filteredEmployees = [...allEmployees];
            currentPage = 1;
            renderEmployeeTable();
            updateEmployeeStats();
            
            showNotification('ล้างตัวกรองเรียบร้อย แสดงพนักงานทั้งหมด', 'success');
        }

        function renderEmployeeTable() {
            const tbody = document.getElementById('employeeTableBody');
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageEmployees = filteredEmployees.slice(startIndex, endIndex);
            
            if (pageEmployees.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="9" class="p-8 text-center text-gray-500">
                            <i class="fas fa-users text-4xl mb-4 text-gray-300"></i>
                            <p class="text-lg">ไม่พบข้อมูลพนักงาน</p>
                            <p class="text-sm">ลองปรับเปลี่ยนเงื่อนไขการค้นหา</p>
                        </td>
                    </tr>
                `;
            } else {
                tbody.innerHTML = pageEmployees.map(emp => {
                    const profileImg = emp.photoURL || `data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='40' height='40' viewBox='0 0 40 40'%3E%3Ccircle cx='20' cy='20' r='20' fill='%23${getRandomColor()}'/%3E%3Ctext x='20' y='26' text-anchor='middle' fill='white' font-size='12'%3E${emp.name ? emp.name.charAt(3) || emp.name.charAt(0) : 'N'}%3C/text%3E%3C/svg%3E`;
                    
                    const statusColor = emp.status === 'active' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800';
                    const statusText = emp.status === 'active' ? 'ปฏิบัติงาน' : 'ไม่ปฏิบัติงาน';
                    
                    return `
                        <tr class="border-b hover:bg-gray-50 transition-colors">
                            <td class="p-4">
                                <img src="${profileImg}" class="w-10 h-10 rounded-full object-cover" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\\'http://www.w3.org/2000/svg\\' width=\\'40\\' height=\\'40\\' viewBox=\\'0 0 40 40\\'%3E%3Ccircle cx=\\'20\\' cy=\\'20\\' r=\\'20\\' fill=\\'%23gray\\'/%3E%3Ctext x=\\'20\\' y=\\'26\\' text-anchor=\\'middle\\' fill=\\'white\\' font-size=\\'12\\'%3E${emp.name ? emp.name.charAt(0) : 'N'}%3C/text%3E%3C/svg%3E'">
                            </td>
                            <td class="p-4 font-medium">${emp.employeeId || 'ไม่ระบุ'}</td>
                            <td class="p-4 font-semibold">${emp.name || 'ไม่ระบุชื่อ'}</td>
                            <td class="p-4">${emp.position || 'ไม่ระบุตำแหน่ง'}</td>
                            <td class="p-4">
                                <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs font-medium">
                                    ${emp.department || 'ไม่ระบุ'}
                                </span>
                            </td>
                            <td class="p-4 text-sm">${emp.employeeType || 'ไม่ระบุ'}</td>
                            <td class="p-4">${emp.phone || '-'}</td>
                            <td class="p-4">
                                <span class="${statusColor} px-2 py-1 rounded-full text-xs font-medium">
                                    ${statusText}
                                </span>
                            </td>
                            <td class="p-4">
                                <div class="flex space-x-2">
                                    <button onclick="viewEmployeeDetails('${emp.id}')" class="bg-blue-500 text-white px-3 py-1 rounded text-xs hover:bg-blue-600 transition" title="ดูรายละเอียด">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button onclick="editEmployee('${emp.id}')" class="bg-yellow-500 text-white px-3 py-1 rounded text-xs hover:bg-yellow-600 transition" title="แก้ไข">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button onclick="deleteEmployee('${emp.id}')" class="bg-red-500 text-white px-3 py-1 rounded text-xs hover:bg-red-600 transition" title="ลบ">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                }).join('');
            }
            
            updatePagination();
        }

        function updatePagination() {
            const totalPages = Math.ceil(filteredEmployees.length / itemsPerPage);
            const startIndex = (currentPage - 1) * itemsPerPage + 1;
            const endIndex = Math.min(currentPage * itemsPerPage, filteredEmployees.length);
            
            document.getElementById('showingFrom').textContent = filteredEmployees.length > 0 ? startIndex : 0;
            document.getElementById('showingTo').textContent = endIndex;
            document.getElementById('totalRecords').textContent = filteredEmployees.length;
            
            const paginationControls = document.getElementById('paginationControls');
            
            if (totalPages <= 1) {
                paginationControls.innerHTML = '';
                return;
            }
            
            let paginationHTML = '';
            
            // Previous button
            if (currentPage > 1) {
                paginationHTML += `
                    <button onclick="changePage(${currentPage - 1})" class="px-3 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                `;
            }
            
            // Page numbers
            for (let i = 1; i <= totalPages; i++) {
                if (i === currentPage) {
                    paginationHTML += `
                        <button class="px-3 py-2 bg-blue-500 text-white border border-blue-500 rounded-lg">
                            ${i}
                        </button>
                    `;
                } else if (i === 1 || i === totalPages || (i >= currentPage - 2 && i <= currentPage + 2)) {
                    paginationHTML += `
                        <button onclick="changePage(${i})" class="px-3 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition">
                            ${i}
                        </button>
                    `;
                } else if (i === currentPage - 3 || i === currentPage + 3) {
                    paginationHTML += `<span class="px-3 py-2">...</span>`;
                }
            }
            
            // Next button
            if (currentPage < totalPages) {
                paginationHTML += `
                    <button onclick="changePage(${currentPage + 1})" class="px-3 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                `;
            }
            
            paginationControls.innerHTML = paginationHTML;
        }

        function changePage(page) {
            currentPage = page;
            renderEmployeeTable();
        }

        function viewEmployeeDetails(employeeId) {
            const employee = allEmployees.find(emp => emp.id === employeeId);
            if (!employee) return;
            
            const detailsHTML = `
                <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" onclick="this.remove()">
                    <div class="bg-white rounded-2xl p-8 max-w-2xl w-full mx-4 max-h-screen overflow-y-auto" onclick="event.stopPropagation()">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-2xl font-bold">รายละเอียดพนักงาน</h3>
                            <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700 text-2xl">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        
                        <div class="text-center mb-6">
                            <img src="${employee.photoURL || `data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='120' viewBox='0 0 120 120'%3E%3Ccircle cx='60' cy='60' r='60' fill='%23${getRandomColor()}'/%3E%3Ctext x='60' y='75' text-anchor='middle' fill='white' font-size='36'%3E${employee.name ? employee.name.charAt(3) || employee.name.charAt(0) : 'N'}%3C/text%3E%3C/svg%3E`}" class="w-32 h-32 rounded-full object-cover mx-auto mb-4 border-4 border-gray-200">
                            <h4 class="text-xl font-bold">${employee.name}</h4>
                            <p class="text-gray-600">${employee.position}</p>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-1">รหัสพนักงาน</label>
                                    <p class="text-gray-900">${employee.employeeId || 'ไม่ระบุ'}</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-1">หมวดงาน</label>
                                    <p class="text-gray-900">${employee.department || 'ไม่ระบุ'}</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-1">ประเภทการจ้าง</label>
                                    <p class="text-gray-900">${employee.employeeType || 'ไม่ระบุ'}</p>
                                </div>
                            </div>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-1">เบอร์โทรศัพท์</label>
                                    <p class="text-gray-900">${employee.phone || 'ไม่ระบุ'}</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-1">สถานะ</label>
                                    <span class="${employee.status === 'active' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'} px-3 py-1 rounded-full text-sm font-medium">
                                        ${employee.status === 'active' ? 'ปฏิบัติงาน' : 'ไม่ปฏิบัติงาน'}
                                    </span>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-1">วันที่เพิ่มข้อมูล</label>
                                    <p class="text-gray-900">${employee.createdAt ? new Date(employee.createdAt.toDate()).toLocaleDateString('th-TH') : 'ไม่ระบุ'}</p>
                                </div>
                            </div>
                        </div>
                        
                        ${employee.jobDescription ? `
                        <div class="mt-6">
                            <label class="block text-sm font-semibold text-gray-700 mb-1">รายละเอียดงาน</label>
                            <p class="text-gray-900 bg-gray-50 p-3 rounded-lg">${employee.jobDescription}</p>
                        </div>
                        ` : ''}
                        
                        ${employee.address ? `
                        <div class="mt-4">
                            <label class="block text-sm font-semibold text-gray-700 mb-1">ที่อยู่</label>
                            <p class="text-gray-900 bg-gray-50 p-3 rounded-lg">${employee.address}</p>
                        </div>
                        ` : ''}
                        
                        <div class="flex space-x-4 mt-8">
                            <button onclick="editEmployee('${employee.id}')" class="flex-1 bg-blue-500 text-white py-3 px-4 rounded-lg hover:bg-blue-600 transition font-semibold">
                                <i class="fas fa-edit mr-2"></i>แก้ไขข้อมูล
                            </button>
                            <button onclick="this.closest('.fixed').remove()" class="flex-1 bg-gray-500 text-white py-3 px-4 rounded-lg hover:bg-gray-600 transition font-semibold">
                                <i class="fas fa-times mr-2"></i>ปิด
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', detailsHTML);
        }

        function exportEmployeeList() {
            if (filteredEmployees.length === 0) {
                showNotification('ไม่มีข้อมูลพนักงานให้ส่งออก', 'warning');
                return;
            }
            
            // สร้างข้อมูล CSV
            const headers = ['รหัสพนักงาน', 'ชื่อ-นามสกุล', 'ตำแหน่ง', 'หมวดงาน', 'ประเภทการจ้าง', 'เบอร์โทรศัพท์', 'สถานะ'];
            const csvContent = [
                headers.join(','),
                ...filteredEmployees.map(emp => [
                    emp.employeeId || '',
                    emp.name || '',
                    emp.position || '',
                    emp.department || '',
                    emp.employeeType || '',
                    emp.phone || '',
                    emp.status === 'active' ? 'ปฏิบัติงาน' : 'ไม่ปฏิบัติงาน'
                ].join(','))
            ].join('\n');
            
            // สร้างไฟล์และดาวน์โหลด
            const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `รายชื่อพนักงาน_${new Date().toLocaleDateString('th-TH').replace(/\//g, '-')}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification(`ส่งออกข้อมูลพนักงาน ${filteredEmployees.length} คน เรียบร้อย`, 'success');
        }

        // Firebase Functions
        async function saveEmployee(employeeData) {
            try {
                if (!db) {
                    // Demo mode - เพิ่มลง array
                    const newEmployee = {
                        id: 'demo_' + Date.now(),
                        ...employeeData,
                        createdAt: new Date()
                    };
                    allEmployees.push(newEmployee);
                    showNotification('บันทึกข้อมูลพนักงานเรียบร้อย (โหมด Demo)', 'success');
                    return;
                }
                
                // สร้าง ID อัตโนมัติ
                const docRef = await db.collection('employees').add({
                    ...employeeData,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    status: 'active'
                });
                
                console.log('Employee saved with ID:', docRef.id);
                showNotification('บันทึกข้อมูลพนักงานเรียบร้อย', 'success');
                
            } catch (error) {
                console.error('Error saving employee:', error);
                showNotification('เกิดข้อผิดพลาดในการบันทึกข้อมูล: ' + error.message, 'error');
            }
        }

        async function updateEmployee(employeeId, employeeData) {
            try {
                if (!db) {
                    // Demo mode - อัพเดตใน array
                    const index = allEmployees.findIndex(emp => emp.id === employeeId);
                    if (index !== -1) {
                        allEmployees[index] = { ...allEmployees[index], ...employeeData, updatedAt: new Date() };
                        showNotification('อัพเดตข้อมูลพนักงานเรียบร้อย (โหมด Demo)', 'success');
                    }
                    return;
                }
                
                // อัพเดตใน Firebase
                await db.collection('employees').doc(employeeId).update({
                    ...employeeData,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                console.log('Employee updated with ID:', employeeId);
                showNotification('อัพเดตข้อมูลพนักงานเรียบร้อย', 'success');
                
            } catch (error) {
                console.error('Error updating employee:', error);
                showNotification('เกิดข้อผิดพลาดในการอัพเดตข้อมูล: ' + error.message, 'error');
            }
        }

        async function uploadPhoto(file) {
            try {
                if (!storage) {
                    throw new Error('Firebase Storage ไม่ได้เชื่อมต่อ');
                }
                
                const fileName = `employees/${Date.now()}_${file.name}`;
                const storageRef = storage.ref().child(fileName);
                
                const snapshot = await storageRef.put(file);
                const downloadURL = await snapshot.ref.getDownloadURL();
                
                console.log('Photo uploaded:', downloadURL);
                return downloadURL;
                
            } catch (error) {
                console.error('Error uploading photo:', error);
                showNotification('เกิดข้อผิดพลาดในการอัพโหลดรูปภาพ: ' + error.message, 'error');
                return null;
            }
        }

        async function saveAttendance(employeeId, type, timestamp) {
            try {
                if (!db) {
                    throw new Error('Firebase ไม่ได้เชื่อมต่อ');
                }
                
                await db.collection('attendance').add({
                    employeeId: employeeId,
                    type: type, // 'in' หรือ 'out'
                    timestamp: timestamp,
                    date: new Date().toISOString().split('T')[0],
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                console.log('Attendance saved');
                
            } catch (error) {
                console.error('Error saving attendance:', error);
                showNotification('เกิดข้อผิดพลาดในการบันทึกเวลา: ' + error.message, 'error');
            }
        }

        async function saveLeaveRequest(leaveData) {
            try {
                if (!db) {
                    throw new Error('Firebase ไม่ได้เชื่อมต่อ');
                }
                
                await db.collection('leave_requests').add({
                    ...leaveData,
                    status: 'pending',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                console.log('Leave request saved');
                
            } catch (error) {
                console.error('Error saving leave request:', error);
                showNotification('เกิดข้อผิดพลาดในการส่งคำขอลา: ' + error.message, 'error');
            }
        }

        async function loadEmployees() {
            try {
                if (!db) {
                    console.log('Firebase not connected, using demo data');
                    return;
                }
                
                console.log('Loading employees from Firebase...');
                
                // ลองโหลดข้อมูลทั้งหมดก่อน (ไม่กรองสถานะ)
                const snapshot = await db.collection('employees').get();
                
                const employees = [];
                snapshot.forEach(doc => {
                    const data = doc.data();
                    console.log('Employee data:', { id: doc.id, ...data });
                    employees.push({ id: doc.id, ...data });
                });
                
                console.log('Total employees loaded:', employees.length);
                
                if (employees.length > 0) {
                    updateEmployeeSelects(employees);
                    updateEmployeeCards(employees);
                    showNotification(`โหลดข้อมูลพนักงาน ${employees.length} คน`, 'success');
                } else {
                    console.log('No employees found in database');
                    showNotification('ไม่พบข้อมูลพนักงานในระบบ', 'info');
                }
                
            } catch (error) {
                console.error('Error loading employees:', error);
                showNotification('เกิดข้อผิดพลาดในการโหลดข้อมูลพนักงาน: ' + error.message, 'error');
            }
        }

        async function updateLeaveBalanceInDB(employeeId, newBalance, reason) {
            try {
                if (!db) {
                    throw new Error('Firebase ไม่ได้เชื่อมต่อ');
                }
                
                await db.collection('leave_balances').doc(employeeId).set({
                    remaining: newBalance,
                    lastUpdated: firebase.firestore.FieldValue.serverTimestamp(),
                    reason: reason,
                    updatedBy: 'admin'
                }, { merge: true });
                
                console.log('Leave balance updated in database');
                
            } catch (error) {
                console.error('Error updating leave balance:', error);
                showNotification('เกิดข้อผิดพลาดในการอัพเดตวันลา: ' + error.message, 'error');
            }
        }

        function updateEmployeeSelects(employees) {
            const selects = [
                document.getElementById('employeeSelect'),
                document.getElementById('leaveEmployeeSelect')
            ];
            
            selects.forEach(select => {
                if (select) {
                    // เก็บ option แรก (placeholder)
                    const firstOption = select.firstElementChild;
                    select.innerHTML = '';
                    select.appendChild(firstOption);
                    
                    // เพิ่ม employees ใหม่
                    employees.forEach(emp => {
                        const option = document.createElement('option');
                        option.value = emp.id;
                        option.textContent = `${emp.name} - ${emp.department} (${emp.employeeType})`;
                        if (emp.employeeType) {
                            option.setAttribute('data-type', emp.employeeType);
                        }
                        select.appendChild(option);
                    });
                }
            });
        }

        function updateEmployeeCards(employees) {
            console.log('Updating employee cards with', employees.length, 'employees');
            
            const employeeGrid = document.querySelector('#employees .grid.grid-cols-1.md\\:grid-cols-2.lg\\:grid-cols-3');
            if (!employeeGrid) {
                console.error('Employee grid not found');
                return;
            }
            
            // ล้างการ์ดเก่า
            employeeGrid.innerHTML = '';
            
            // ถ้าไม่มีพนักงาน แสดงข้อความ
            if (employees.length === 0) {
                employeeGrid.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <i class="fas fa-users text-6xl text-gray-300 mb-4"></i>
                        <p class="text-gray-500 text-lg">ยังไม่มีข้อมูลพนักงาน</p>
                        <p class="text-gray-400">คลิก "เพิ่มพนักงาน" เพื่อเริ่มต้น</p>
                        <button onclick="loadEmployees()" class="mt-4 bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition">
                            <i class="fas fa-sync-alt mr-2"></i>รีเฟรชข้อมูล
                        </button>
                    </div>
                `;
                return;
            }
            
            // สร้างการ์ดใหม่สำหรับแต่ละพนักงาน
            employees.forEach((emp, index) => {
                console.log(`Creating card for employee ${index + 1}:`, emp.name);
                
                const card = document.createElement('div');
                card.className = 'bg-white border border-gray-200 rounded-xl p-6 hover-scale';
                
                // สร้างรูปโปรไฟล์
                const profileImg = emp.photoURL || `data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='80' height='80' viewBox='0 0 80 80'%3E%3Ccircle cx='40' cy='40' r='40' fill='%23${getRandomColor()}'/%3E%3Ctext x='40' y='50' text-anchor='middle' fill='white' font-size='24'%3E${emp.name ? emp.name.charAt(3) || emp.name.charAt(0) : 'N'}%3C/text%3E%3C/svg%3E`;
                
                // กำหนดสีสถานะ
                const status = emp.status || 'active';
                const statusColor = status === 'active' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800';
                const statusText = status === 'active' ? 'ปฏิบัติงาน' : 'ไม่ปฏิบัติงาน';
                
                card.innerHTML = `
                    <div class="flex items-center mb-4">
                        <img src="${profileImg}" class="profile-img rounded-full mr-4" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\\'http://www.w3.org/2000/svg\\' width=\\'80\\' height=\\'80\\' viewBox=\\'0 0 80 80\\'%3E%3Ccircle cx=\\'40\\' cy=\\'40\\' r=\\'40\\' fill=\\'%23gray\\'/%3E%3Ctext x=\\'40\\' y=\\'50\\' text-anchor=\\'middle\\' fill=\\'white\\' font-size=\\'24\\'%3E${emp.name ? emp.name.charAt(0) : 'N'}%3C/text%3E%3C/svg%3E'">
                        <div class="flex-1">
                            <h3 class="font-bold text-lg">${emp.name || 'ไม่ระบุชื่อ'}</h3>
                            <p class="text-gray-600">${emp.position || 'ไม่ระบุตำแหน่ง'}</p>
                            <p class="text-sm text-blue-600">${emp.department || 'ไม่ระบุหมวดงาน'}</p>
                        </div>
                    </div>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span class="text-gray-600">รหัส:</span>
                            <span class="font-medium">${emp.employeeId || 'ไม่ระบุ'}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">ประเภท:</span>
                            <span class="font-medium">${emp.employeeType || 'ไม่ระบุ'}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">สถานะ:</span>
                            <span class="${statusColor} px-2 py-1 rounded-full text-xs">${statusText}</span>
                        </div>
                        ${emp.phone ? `
                        <div class="flex justify-between">
                            <span class="text-gray-600">โทร:</span>
                            <span class="font-medium">${emp.phone}</span>
                        </div>
                        ` : ''}
                    </div>
                    <div class="flex space-x-2 mt-4">
                        <button onclick="editEmployee('${emp.id}')" class="flex-1 bg-blue-500 text-white py-2 px-3 rounded-lg text-sm hover:bg-blue-600 transition">
                            <i class="fas fa-edit mr-1"></i>แก้ไข
                        </button>
                        <button onclick="deleteEmployee('${emp.id}')" class="flex-1 bg-red-500 text-white py-2 px-3 rounded-lg text-sm hover:bg-red-600 transition">
                            <i class="fas fa-trash mr-1"></i>ลบ
                        </button>
                    </div>
                `;
                
                employeeGrid.appendChild(card);
            });
            
            console.log('Employee cards updated successfully');
        }
        
        function getRandomColor() {
            const colors = ['10b981', '3b82f6', 'f59e0b', 'ef4444', '8b5cf6', '06b6d4', 'f97316', '84cc16'];
            return colors[Math.floor(Math.random() * colors.length)];
        }
        
        // Edit Employee Modal
        let editingEmployeeId = null;

        function editEmployee(employeeId) {
            const employee = allEmployees.find(emp => emp.id === employeeId);
            if (!employee) {
                showNotification('ไม่พบข้อมูลพนักงาน', 'error');
                return;
            }
            
            editingEmployeeId = employeeId;
            
            // เปิด modal และเติมข้อมูลเดิม
            showAddEmployeeModal();
            
            // เปลี่ยนหัวข้อ modal
            document.querySelector('#addEmployeeModal h3').innerHTML = `
                <i class="fas fa-user-edit text-blue-600 mr-3"></i>
                แก้ไขข้อมูลพนักงาน
            `;
            
            // เติมข้อมูลเดิมในฟอร์ม
            const form = document.getElementById('addEmployeeForm');
            form.name.value = employee.name || '';
            form.employeeId.value = employee.employeeId || '';
            form.position.value = employee.position || '';
            form.department.value = employee.department || '';
            form.employeeType.value = employee.employeeType || '';
            form.phone.value = employee.phone || '';
            form.jobDescription.value = employee.jobDescription || '';
            form.address.value = employee.address || '';
            
            // แสดงรูปเดิม
            if (employee.photoURL) {
                document.getElementById('photoPreview').src = employee.photoURL;
            }
            
            // เปลี่ยนปุ่มบันทึก
            const submitBtn = form.querySelector('button[type="submit"]');
            submitBtn.innerHTML = '<i class="fas fa-save mr-2"></i>อัพเดตข้อมูล';
        }
        
        async function deleteEmployee(employeeId) {
            const employee = allEmployees.find(emp => emp.id === employeeId);
            if (!employee) {
                showNotification('ไม่พบข้อมูลพนักงาน', 'error');
                return;
            }
            
            // แสดง confirmation dialog ที่สวยกว่า
            const confirmHTML = `
                <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" id="deleteConfirmModal">
                    <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4">
                        <div class="text-center">
                            <div class="bg-red-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-trash text-red-600 text-2xl"></i>
                            </div>
                            <h3 class="text-xl font-bold mb-2">ยืนยันการลบพนักงาน</h3>
                            <p class="text-gray-600 mb-2">คุณต้องการลบพนักงานคนนี้หรือไม่?</p>
                            <div class="bg-gray-50 p-4 rounded-lg mb-6">
                                <p class="font-semibold">${employee.name}</p>
                                <p class="text-sm text-gray-600">${employee.position} - ${employee.department}</p>
                            </div>
                            <div class="flex space-x-3">
                                <button onclick="document.getElementById('deleteConfirmModal').remove()" class="flex-1 bg-gray-500 text-white py-3 px-4 rounded-lg hover:bg-gray-600 transition font-semibold">
                                    <i class="fas fa-times mr-2"></i>ยกเลิก
                                </button>
                                <button onclick="confirmDeleteEmployee('${employeeId}')" class="flex-1 bg-red-500 text-white py-3 px-4 rounded-lg hover:bg-red-600 transition font-semibold">
                                    <i class="fas fa-trash mr-2"></i>ลบพนักงาน
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', confirmHTML);
        }
        
        async function confirmDeleteEmployee(employeeId) {
            try {
                document.getElementById('deleteConfirmModal').remove();
                
                if (!db) {
                    // ถ้าไม่มี Firebase ให้ลบจาก array
                    allEmployees = allEmployees.filter(emp => emp.id !== employeeId);
                    filteredEmployees = filteredEmployees.filter(emp => emp.id !== employeeId);
                    showNotification('ลบพนักงานเรียบร้อย (โหมด Demo)', 'success');
                    await refreshAllData();
                    return;
                }
                
                // ลบจาก Firebase
                await db.collection('employees').doc(employeeId).delete();
                
                showNotification('ลบพนักงานเรียบร้อย', 'success');
                await refreshAllData();
                
            } catch (error) {
                console.error('Error deleting employee:', error);
                showNotification('เกิดข้อผิดพลาดในการลบพนักงาน: ' + error.message, 'error');
            }
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96716d6222da7b52',t:'MTc1Mzg0MjU1NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
